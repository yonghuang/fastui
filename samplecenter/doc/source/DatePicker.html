<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='fastDev-Ui-DatePicker'>/**
</span> * @class fastDev.Ui.DatePicker
 * @extends fastDev.Ui.Box
 * @author chengwei
 * &lt;p&gt;日期选择控件提供日期时间选择功能，且能对日期时间范围作出动态限制。&lt;/p&gt;
 * &lt;p&gt;作者：程伟&lt;/p&gt;
 *     
 *     &lt;input itype=&quot;DatePicker&quot; value=&quot;2012-8-25&quot; /&gt;
 */
fastDev.define(&quot;fastDev.Ui.DatePicker&quot;, {
    alias: &quot;DatePicker&quot;,
    extend: &quot;fastDev.Ui.Box&quot;,
    _options: {
<span id='fastDev-Ui-DatePicker-property-width'>        /**
</span>         * 控件宽度
         * @type {String}
         */
        width: &quot;160px&quot;,
<span id='fastDev-Ui-DatePicker-property-zIndex'>        /**
</span>         * 索引重置
         * @type {Number}
         */
        zIndex: 2012,
<span id='fastDev-Ui-DatePicker-property-value'>        /**
</span>         * 设定日期值
         * @type {String}
         */
        value: &quot;&quot;,
<span id='fastDev-Ui-DatePicker-property-name'>        /**
</span>         * 输入框名称
         * @type {String}
         */
        name: &quot;&quot;,
<span id='fastDev-Ui-DatePicker-property-trigger'>        /**
</span>         * 日期选择的触发方式
         * &lt;p&gt;- button: 仅仅在点击图标按钮时触发日期选择&lt;/p&gt;
         * &lt;p&gt; -click: 输入框或图标上发生点击事件时触发&lt;/p&gt;
         * &lt;p&gt; -mouseover: 鼠标悬浮至输入框或图标上时触发&lt;/p&gt;
         * &lt;p&gt; -[eventType] :其他任何有效事件类型&lt;/p&gt;
         * @type {String}
         */
        trigger: &quot;click&quot;,
<span id='fastDev-Ui-DatePicker-property-format'>        /**
</span>         * 日期时间格式
         * &lt;p&gt;格式表达式，变量含义:&lt;/p&gt;
         * &lt;p&gt;-yyyy: 带 0 补齐的四位年表示&lt;/p&gt;
         * &lt;p&gt;-yy: 带 0 补齐的两位年表示&lt;/p&gt;
         * &lt;p&gt;-MM: 带 0 补齐的两位月表示&lt;/p&gt;
         * &lt;p&gt;-M: 不带 0 补齐的月表示&lt;/p&gt;
         * &lt;p&gt;-dd: 带 0 补齐的两位日表示&lt;/p&gt;
         * &lt;p&gt;-d: 不带 0 补齐的日表示&lt;/p&gt;
         * &lt;p&gt;-hh: 带 0 补齐的两位 12 进制时表示&lt;/p&gt;
         * &lt;p&gt;-h: 不带 0 补齐的 12 进制时表示&lt;/p&gt;
         * &lt;p&gt;-HH: 带 0 补齐的两位 24 进制时表示&lt;/p&gt;
         * &lt;p&gt;-H: 不带 0 补齐的 24 进制时表示&lt;/p&gt;
         * &lt;p&gt;-mm: 带 0 补齐两位分表示&lt;/p&gt;
         * &lt;p&gt;-m: 不带 0 补齐分表示&lt;/p&gt;
         * &lt;p&gt;-ss: 带 0 补齐两位秒表示&lt;/p&gt;
         * &lt;p&gt;-s: 不带 0 补齐秒表示&lt;/p&gt;
         * @type {String}
         */
        format: &quot;yyyy-MM-dd&quot;,
<span id='fastDev-Ui-DatePicker-property-firstDayOfWeek'>        /**
</span>         * 定义星期的第一天，可选值0~6
         * 星期日为0、星期一为1、星期六为6
         * @type {Number}
         */
        firstDayOfWeek: 0,
<span id='fastDev-Ui-DatePicker-property-minDate'>        /**
</span>         * 最小日期限制（默认会取1900年1月1日0时0分0秒）
         * @type {String|Date}
         */
        minDate: null,
<span id='fastDev-Ui-DatePicker-property-maxDate'>        /**
</span>         * 最大日期限制（默认会取2099年12月31日23时59分59秒）
         * @type {String|Date}
         */
        maxDate: null,
<span id='fastDev-Ui-DatePicker-property-includes'>        /**
</span>         * 可选择的日期时间值表达式组
         * 此表达式为cron日期表达式，其格式为用空格分隔的7个子表达式域，如：
         *  0 15 10 ? * 6L 2002-2005
         * [秒   分     时] 日  月   周   年
         * 可以不声明   ”秒“ “分” “时”子表达式，表达式长度等于3或等于4时，会默认&quot;秒 分 时&quot;为 &quot;?&quot;值
         * 上述表达式表示：在 2002, 2003, 2004和 2005 年中的每月最后一个周五（星期日为1，星期一为2，依此类推）的 10:15 AM
         * 更多有关于cron日期表达式的信息，请参考相关资料或在线示例
         * @type {String|Array}
         */
        includes: [],
<span id='fastDev-Ui-DatePicker-property-excludes'>        /**
</span>         * 被禁用的日期时间值表达式组
         * includes属性中指明的可选值也会在excludes声明中被排除
         * 此表达式为cron表达式
         * 可以不声明   ”秒“ “分” “时”子表达式，表达式长度等于3或等于4时，会默认&quot;秒 分 时&quot;为 &quot;?&quot;值
         * 更多有关于cron日期表达式的信息，请参考相关资料或在线示例
         * @type {String|Array}
         */
        excludes: [],
<span id='fastDev-Ui-DatePicker-property-showTimePicker'>        /**
</span>         * 是否显示时间选择器
         * 控件默认会根据日期时间格式来判定是否需要显示时间选择器
         * 也可以通过该属性强制开启或关闭时间选择器，但最终日期时间值仍受限于format属性指定的格式
         * @type {Boolean}
         */
        showTimePicker: null,
<span id='fastDev-Ui-DatePicker-property-showLunarTips'>        /**
</span>         * 是否显示农历日期值提示
         * @type {Boolean}
         */
        showLunarTips: true,
<span id='fastDev-Ui-DatePicker-property-timeBefore'>        /**
</span>         * 指定可选时间必须在另外一个DatePicker控件已选日期值之前
         * 即设置当前控件的最大日期值为该属性所指定日期控件的已选日期值
         * 另外也可以通过onPick事件回调来动态设置本控件的最大最小日期值限制
         * 可传控件ID或者fastDev.Ui.DatePicker对象
         * @type {String|fastDev.Ui.DatePicker}
         */
        timeBefore: null,
<span id='fastDev-Ui-DatePicker-property-timeAfter'>        /**
</span>         * 指定可选时间必须在另外一个DatePicker控件已选日期值之后
         * 即设置当前控件的最小日期值为该属性所指定的日期控件的已选日期值
         * 另外也可以通过onPick事件回调来动态设置本控件的最大最小日期值限制
         * 可传控件ID或者fastDev.Ui.DatePicker对象
         * @type {String|fastDev.Ui.DatePicker}
         */
        timeAfter: null,
<span id='fastDev-Ui-DatePicker-property-readonly'>        /**
</span>         * 是否只读
         * @type {Boolean}
         */
        readonly: false,
<span id='fastDev-Ui-DatePicker-property-display'>        /**
</span>         * 日历面板展现类型，为以下枚举值：
         * &lt;p&gt;-block: 以弹出层形式展现，默认方式 &lt;/p&gt;
         * &lt;p&gt;-inline: 以行内块形式展现，即平面模式 &lt;/p&gt;
         * @type {String}
         */
        display: &quot;block&quot;,
<span id='fastDev-Ui-DatePicker-event-onPick'>        /**
</span>         * 选择日期值后的回调事件，传递参数为当前拟选的日期对象(Date对象)和根据格式参数格式化后的日期时间值(字符串值)
         * 若回调函数返回false，则不会选择当前拟选的日期值
         * this指向当前日历控件
         * @type {Function}
         * @event
         */
        onPick: fastDev.noop,
        enabledDataProxy: false,
        enabledInitProxy: false
    },
    template: ['&lt;tpl if(&quot;#{display}&quot;!=&quot;inline&quot;)&gt;',
        '&lt;div class=&quot;ui-form ui-form-wrap ui-date&quot; style=&quot;width:#{width}&quot;&gt;',
        '&lt;input id=&quot;#{id}&quot; type=&quot;text&quot; name=&quot;#{name}&quot; autocomplete=&quot;off&quot; readonly=&quot;readonly&quot; class=&quot;ui-form-field ui-form-input&quot; value=&quot;#{value}&quot; style=&quot;width:#{inputWidth}&quot;/&gt;',
        '&lt;div class=&quot;ui-form-trigger&quot;&gt;',
        '&lt;div id=&quot;datepicker-trigger-#{sequence}&quot; class=&quot;ui-date-icon&quot;&gt;&lt;/div&gt;',
        '&lt;/div&gt;',
        '&lt;/div&gt;',
        '&lt;/tpl&gt;',
        '&lt;div id=&quot;datepicker-#{sequence}&quot; class=&quot;ui-datepicker #{shadowCls}&quot; style=&quot;display:none&quot;&gt;',
        '&lt;div id=&quot;datepicker-header-#{sequence}&quot; class=&quot;ui-datepicker-header&quot;&gt;',
        '&lt;div&gt;',
        '&lt;span name=&quot;prevYearBtn&quot; id=&quot;datepicker-prevyear-#{sequence}&quot; title=&quot;上一年&quot; class=&quot;ui-datepicker-header-page ui-datepicker-header-prevyear&quot;&gt;&lt;/span&gt;',
        '&lt;/div&gt;',
        '&lt;div&gt;',
        '&lt;span name=&quot;prevMonthBtn&quot; id=&quot;datepicker-prevmonth-#{sequence}&quot; title=&quot;上一月&quot; class=&quot;ui-datepicker-header-page ui-datepicker-header-prevmonth&quot;&gt;&lt;/span&gt;',
        '&lt;/div&gt;',
        '&lt;div class=&quot;ui-datepicker-header-text&quot;&gt;',
        '&lt;input name=&quot;monthInput&quot; id=&quot;datepicker-input-month-#{sequence}&quot; class=&quot;ui-datepicker-header-input ui-datepicker-header-month&quot;/&gt;',
        '&lt;input name=&quot;yearInput&quot; id=&quot;datepicker-input-year-#{sequence}&quot; class=&quot;ui-datepicker-header-input ui-datepicker-header-year&quot;/&gt;',
        '&lt;/div&gt;',
        '&lt;div&gt;',
        '&lt;span name=&quot;nextMonthBtn&quot; id=&quot;datepicker-nextmonth-#{sequence}&quot; title=&quot;下一月&quot; class=&quot;ui-datepicker-header-page ui-datepicker-header-nextmonth&quot;&gt;&lt;/span&gt;',
        '&lt;/div&gt;',
        '&lt;div&gt;',
        '&lt;span name=&quot;nextYearBtn&quot; id=&quot;datepicker-nextyear-#{sequence}&quot; title=&quot;下一年&quot; class=&quot;ui-datepicker-header-page ui-datepicker-header-nextyear&quot;&gt;&lt;/span&gt;',
        '&lt;/div&gt;',
        '&lt;/div&gt;',
        '&lt;div class=&quot;ui-datepicker-body&quot;&gt;',
        '&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; border=&quot;0&quot; class=&quot;ui-datepicker-weekday&quot;&gt;',
        '&lt;thead&gt;',
        '&lt;tr id=&quot;datepicker-weekday-title-#{sequence}&quot; class=&quot;ui-datepicker-weekday-title&quot;&gt;&lt;/tr&gt;',
        '&lt;/thead&gt;',
        '&lt;tbody id=&quot;datepicker-body-#{sequence}&quot;&gt;&lt;/tbody&gt;',
        '&lt;/table&gt;',
        '&lt;/div&gt;',
        '&lt;div id=&quot;datepicker-toolbar-#{sequence}&quot; class=&quot;ui-datepicker-toolbar&quot;&gt;',
        '&lt;tpl if(#{showTimePicker}==true)&gt;',
        '&lt;div class=&quot;ui-datepicker-time&quot; style=&quot;display:block;&quot;&gt;',
        '&lt;div id=&quot;timepicker-numberbox-#{sequence}&quot; class=&quot;ui-form ui-form-wrap ui-numberbox&quot; style=&quot;width:80px;left:0px;top:0px&quot;&gt;',
        '&lt;input name=&quot;timePickerHours&quot; id=&quot;timepicker-hours-#{sequence}&quot; title=&quot;时&quot; type=&quot;text&quot; autocomplete=&quot;off&quot; class=&quot;ui-form-field ui-form-input&quot; style=&quot;width:16px&quot;/&gt;:',
        '&lt;input name=&quot;timePickerMinutes&quot; id=&quot;timepicker-minutes-#{sequence}&quot; title=&quot;分&quot; type=&quot;text&quot; autocomplete=&quot;off&quot; class=&quot;ui-form-field ui-form-input&quot; style=&quot;width:16px&quot;/&gt;:',
        '&lt;input name=&quot;timePickerSeconds&quot; id=&quot;timepicker-seconds-#{sequence}&quot; title=&quot;秒&quot; type=&quot;text&quot; autocomplete=&quot;off&quot; class=&quot;ui-form-field ui-form-input&quot; style=&quot;width:16px&quot;/&gt;',
        '&lt;div id=&quot;datepicker-timepicker-trigger-#{sequence}&quot; class=&quot;ui-form-trigger&quot;&gt;',
        '&lt;div class=&quot;ui-numberbox-up&quot;&gt;',
        '&lt;div name=&quot;timePickerUpBtn&quot; title=&quot;递增时间&quot; id=&quot;timepicker-up-#{sequence}&quot; class=&quot;ui-numberbox-icon&quot;&gt;&lt;/div&gt;',
        '&lt;/div&gt;',
        '&lt;div class=&quot;ui-numberbox-split&quot;&gt;&lt;/div&gt;',
        '&lt;div class=&quot;ui-numberbox-down&quot;&gt;',
        '&lt;div name=&quot;timePickerDownBtn&quot; title=&quot;递减时间&quot; id=&quot;timepicker-down-#{sequence}&quot; class=&quot;ui-numberbox-icon&quot;&gt;&lt;/div&gt;',
        '&lt;/div&gt;',
        '&lt;/div&gt;',
        '&lt;/div&gt;',
        '&lt;/div&gt;',
        '&lt;/tpl&gt;',
        '&lt;div class=&quot;ui-datepicker-button&quot;&gt;',
        '&lt;tpl if(#{showTimePicker}==true)&gt;',
        '&lt;a class=&quot;ui-button ui-button-bg&quot;&gt;',
        '&lt;em class=&quot;ui-button-em&quot;&gt;&lt;span name=&quot;confirmBtn&quot; id=&quot;datepicker-button-confirm-#{sequence}&quot; class=&quot;ui-button-text&quot;&gt;确定&lt;/span&gt;&lt;/em&gt;',
        '&lt;/a&gt;',
        '&lt;tpl else&gt;',
        '&lt;a class=&quot;ui-button ui-button-bg&quot;&gt;',
        '&lt;em class=&quot;ui-button-em&quot;&gt;&lt;span name=&quot;todayBtn&quot; id=&quot;datepicker-button-today-#{sequence}&quot; class=&quot;ui-button-text&quot;&gt;今天&lt;/span&gt;&lt;/em&gt;',
        '&lt;/a&gt;',
        '&lt;/tpl&gt;',
        '&lt;a class=&quot;ui-button ui-button-bg&quot;&gt;',
        '&lt;em class=&quot;ui-button-em&quot;&gt;&lt;span name=&quot;cleanBtn&quot; id=&quot;datepicker-button-clean-#{sequence}&quot; class=&quot;ui-button-text&quot;&gt;清除&lt;/span&gt;&lt;/em&gt;',
        '&lt;/a&gt;',
        '&lt;/div&gt;',
        '&lt;div class=&quot;ui-clear&quot;&gt;&lt;/div&gt;',
        '&lt;/div&gt;',
        '&lt;div class=&quot;ui-clear&quot;&gt;&lt;/div&gt;',
        '&lt;/div&gt;',
        '&lt;div id=&quot;datepicker-menu-month-#{sequence}&quot; class=&quot;ui-datepicker-menu-month ui-shadow&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;',
        '&lt;div id=&quot;datepicker-menu-year-#{sequence}&quot; class=&quot;ui-datepicker-menu-year ui-shadow&quot; style=&quot;display:none;&quot;&gt;',
        '&lt;div id=&quot;datepicker-menu-year-placeholder-#{sequence}&quot;&gt;&lt;/div&gt;',
        '&lt;div class=&quot;ui-clear&quot;&gt;&lt;/div&gt;',
        '&lt;div class=&quot;ui-datepicker-menu-year-page&quot;&gt;',
        '&lt;a id=&quot;datepicker-menu-year-prev-#{sequence}&quot; title=&quot;上翻页&quot; name=&quot;prev&quot; class=&quot;ui-datepicker-menu-year-prev&quot;&gt;&amp;nbsp;&amp;laquo;&amp;nbsp;&lt;/a&gt;',
        '&lt;span id=&quot;datepicker-menu-year-line-#{sequence}&quot; class=&quot;ui-datepicker-menu-year-line&quot;&gt;-----&lt;/span&gt;',
        '&lt;a id=&quot;datepicker-menu-year-next-#{sequence}&quot; title=&quot;下翻页&quot; name=&quot;next&quot; class=&quot;ui-datepicker-menu-year-next&quot;&gt;&amp;nbsp;&amp;raquo;&amp;nbsp;&lt;/a&gt;',
        '&lt;/div&gt;',
        '&lt;/div&gt;'],
    tplParam: [&quot;width&quot;, &quot;name&quot;, &quot;inputWidth&quot;, &quot;trigger&quot;, &quot;value&quot;, &quot;sequence&quot;, &quot;id&quot;, &quot;showTimePicker&quot;, &quot;display&quot;, &quot;shadowCls&quot;],
<span id='fastDev-Ui-DatePicker-method-ready'>    /**
</span>     * 准备参数
     * @param {Object} options
     * @param {Object} global
     * @protected
     */
    ready: function (options, global) {
        var that = this;
        fastDev.apply(global, {
            sequence: fastDev.getID(),
            minYear: 1900,
            maxYear: 2099,
            minDate: new Date(0, 0, 1),
            maxDate: new Date(2099, 11, 31, 23, 59, 59)
        });
        fastDev.apply(options, {
            // 容器有2px的边框
            width: ((fastDev.Util.StringUtil.stripUnits(options.width, options.container.width()) || 160) - 2) + &quot;px&quot;,
            firstDayOfWeek: parseInt(options.firstDayOfWeek, 10) || 0,
            format: fastDev.Util.StringUtil.trim(options.format),
            minDate: options.minDate ? that.toValidDate(options.minDate) : global.minDate,
            maxDate: options.maxDate ? that.toValidDate(options.maxDate) : global.maxDate,
            display: options.display === &quot;inline&quot; ? &quot;inline&quot; : &quot;block&quot;,
            zIndex: parseInt(options.zIndex, 10) || 2012,
            timeAfter: !! options.timeAfter ? options.timeAfter : &quot;&quot;,
            timeBefore: !! options.timeBefore ? options.timeBefore : &quot;&quot;,
            saveInstance: !! options.saveInstance || !! options.timeAfter || !! options.timeBefore,
            onPick: typeof options.onPick === &quot;function&quot; ? options.onPick : fastDev.noop
        });
        // 输入框的宽度等于容器的宽度减去图标的宽度（18px）再减边框的2px（共20px）
        global.inputWidth = (window.parseFloat(options.width) - 20) + &quot;px&quot;;
        options.showTimePicker = this.isShowTimePicker();
        global.shadowCls = options.display === &quot;inline&quot; ? &quot;&quot; : &quot;ui-shadow&quot;;
        global.onBlur = fastDev.noop;
        options.firstDayOfWeek = options.firstDayOfWeek &gt; -1 &amp;&amp; options.firstDayOfWeek &lt; 7 ? options.firstDayOfWeek : 0;
        if (!options.id || !fastDev.Util.StringUtil.trim(options.id)) {
            options.id = fastDev.getID();
        }
    },
<span id='fastDev-Ui-DatePicker-method-construct'>    /**
</span>     * 构造控件
     * @param {Object} options
     * @param {Object} global
     * @protected
     */
    construct: function (options, global) {
        var sequence = global.sequence;
        fastDev.apply(global, {
            input: global.box,
            trigger: this.find(&quot;[id='datepicker-trigger-&quot; + sequence + &quot;']&quot;),
            picker: this.find(&quot;[id='datepicker-&quot; + sequence + &quot;']&quot;).appendTo(document.body),
            yearMenu: this.find(&quot;[id='datepicker-menu-year-&quot; + sequence + &quot;']&quot;).appendTo(document.body),
            monthMenu: this.find(&quot;[id='datepicker-menu-month-&quot; + sequence + &quot;']&quot;).appendTo(document.body),
            yearMenuPlaceHolder: this.find(&quot;[id='datepicker-menu-year-placeholder-&quot; + sequence + &quot;']&quot;),
            yearMenuPrevBtn: this.find(&quot;[id='datepicker-menu-year-prev-&quot; + sequence + &quot;']&quot;),
            yearMenuNextBtn: this.find(&quot;[id='datepicker-menu-year-next-&quot; + sequence + &quot;']&quot;),
            yearMenuLine: this.find(&quot;[id='datepicker-menu-year-line-&quot; + sequence + &quot;']&quot;),
            header: this.find(&quot;[id='datepicker-header-&quot; + sequence + &quot;']&quot;),
            weekdayTitle: this.find(&quot;[id='datepicker-weekday-title-&quot; + sequence + &quot;']&quot;),
            body: this.find(&quot;[id='datepicker-body-&quot; + sequence + &quot;']&quot;),
            toolbar: this.find(&quot;[id='datepicker-toolbar-&quot; + sequence + &quot;']&quot;),
            todayBtn: this.find(&quot;[id='datepicker-button-today-&quot; + sequence + &quot;']&quot;),
            confirmBtn: this.find(&quot;[id='datepicker-button-confirm-&quot; + sequence + &quot;']&quot;),
            cleanBtn: this.find(&quot;[id='datepicker-button-clean-&quot; + sequence + &quot;']&quot;),
            monthInput: this.find(&quot;[id='datepicker-input-month-&quot; + sequence + &quot;']&quot;),
            yearInput: this.find(&quot;[id='datepicker-input-year-&quot; + sequence + &quot;']&quot;),
            prevYearBtn: this.find(&quot;[id='datepicker-prevyear-&quot; + sequence + &quot;']&quot;),
            prevMonthBtn: this.find(&quot;[id='datepicker-prevmonth-&quot; + sequence + &quot;']&quot;),
            nextYearBtn: this.find(&quot;[id='datepicker-nextyear-&quot; + sequence + &quot;']&quot;),
            nextMonthBtn: this.find(&quot;[id='datepicker-nextmonth-&quot; + sequence + &quot;']&quot;)
        });
        if (options.showTimePicker) {
            fastDev.apply(global, {
                timePicker: this.find(&quot;[id='timepicker-numberbox-&quot; + sequence + &quot;']&quot;),
                timePickerUpBtn: this.find(&quot;[id='timepicker-up-&quot; + sequence + &quot;']&quot;),
                timePickerDownBtn: this.find(&quot;[id='timepicker-down-&quot; + sequence + &quot;']&quot;),
                timePickerHours: this.find(&quot;[id='timepicker-hours-&quot; + sequence + &quot;']&quot;),
                timePickerMinutes: this.find(&quot;[id='timepicker-minutes-&quot; + sequence + &quot;']&quot;),
                timePickerSeconds: this.find(&quot;[id='timepicker-seconds-&quot; + sequence + &quot;']&quot;),
                timePickerTrigger: this.find(&quot;[id='datepicker-timepicker-trigger-&quot; + sequence + &quot;']&quot;)
            });
        }
        // 设置星期标题
        this.setWeekdayTitle();
        this.elems.splice(1, 0, &quot;none&quot;);
    },
<span id='fastDev-Ui-DatePicker-method-init'>    /**
</span>     * 初始控件
     * @param {Object} options
     * @param {Object} global
     * @protected
     */
    init: function (options, global) {
        // 初始化日期时间最值设定
        this.setMinDate(options.minDate);
        this.setMaxDate(options.maxDate);
        // 初始化时间表达式
        this.parseCronExpression();
        // 初始化日期选择值
        this.setValue(options.value);
        // 注册事件
        if (options.display === &quot;inline&quot;) {
            // 初始行内模式的日历
            this.initInlinePicker();
        }
        if ( !! options.disabled) {
            this.disable();
        }
        // 刷新界面
        this.freshUI();
        // 绑定相关事件
        this.bindEventHandle();
        // 阻止文本选择
        this.preventTextSelect();
        // 标记为初始完毕，用于被其他日历控件引用时
        global.initialized = true;
    },
<span id='fastDev-Ui-DatePicker-method-onControlBlur'>    /**
</span>     * 失焦验证
     * @param {Function} fn 验证函数
     * @private 
     */
    onControlBlur: function (fn) {
        this._global.onBlur = fn;
    },
<span id='fastDev-Ui-DatePicker-method-initInlinePicker'>    /**
</span>     * 初始化行内模式的日历控件
     * @private
     */
    initInlinePicker: function () {
        var options = this._options,
            global = this._global;
        // 行内模式
        global.toolbar.hide();
        global.picker.css(&quot;position&quot;, &quot;static&quot;);
        options.readonly = false;
        if ( !! options.container.elems[0] &amp;&amp; !(options.container.prop(&quot;disabled&quot;) || options.container.attr(&quot;disabled&quot;))) {
            // 容器未被禁用则添加日历面板
            global.picker.appendTo(options.container);
            this.show();
        }
    },
<span id='fastDev-Ui-DatePicker-method-freshUI'>    /**
</span>     * 对按钮或输入框作禁用处理
     * @param {Boolean} onlyBtn 为true时则只刷新&quot;今天&quot;按钮
     * @private
     */
    freshUI: function (onlyBtn) {
        var options = this._options;
        if (options.display !== &quot;inline&quot;) {
            var global = this._global,
                today = new Date();
            // 如果&quot;今天&quot;不可用，则禁用&quot;今天按钮&quot;
            if (!options.showTimePicker) {
                if (this.isDisabled(today.getFullYear(), today.getMonth(), today.getDate())) {
                    global.todayBtn.parent().parent().addClass(&quot;ui-button-disabled&quot;);
                    global.todayBtn.attr(&quot;forbidden&quot;, &quot;forbidden&quot;);
                } else {
                    global.todayBtn.parent().parent().removeClass(&quot;ui-button-disabled&quot;);
                    global.todayBtn.attr(&quot;forbidden&quot;, &quot;&quot;);
                }
            } else if (!onlyBtn) {
                fastDev.each([&quot;Hours&quot;, &quot;Minutes&quot;, &quot;Seconds&quot;], function (idx, val) {
                    if (!global[&quot;show&quot; + val]) {
                        global[&quot;timePicker&quot; + val].prop(&quot;disabled&quot;, &quot;disabled&quot;).addClass(&quot;ui-datepicker-disabled&quot;);
                    }
                });
            }
        }
    },
<span id='fastDev-Ui-DatePicker-method-bindEventHandle'>    /**
</span>     * 绑定事件处理器
     * @private
     */
    // 考虑建立事件管理器，用代理来托管重复类型的事件
    bindEventHandle: function () {
        var that = this,
            options = this._options,
            global = this._global;
        if (options.display !== &quot;inline&quot;) {
            if (options.trigger === &quot;button&quot;) {
                // 仅点击button时触发
                global.trigger.bind(&quot;click&quot;, fastDev.setFnInScope(this, this.triggerEvent));
            } else {
                // 发生指定事件时触发
                global.input.bind(options.trigger, fastDev.setFnInScope(this, this.triggerEvent));
                global.trigger.bind(options.trigger, fastDev.setFnInScope(this, this.triggerEvent));
            }
        }
        // 绑定日历面板事件代理
        global.picker.bind(&quot;click&quot;, fastDev.setFnInScope(this, this.pickerClick)).bind(&quot;mouseover&quot;, fastDev.setFnInScope(this, this.pickerOver)).bind(&quot;mouseout&quot;, fastDev.setFnInScope(this, this.pickerOut));
        // IE6、7、8下dblclick事件不会执行click事件，点击过快时会有停顿感觉，所以需同时绑dblclick事件
        if (fastDev.Browser.isIE6 || fastDev.Browser.isIE7 || fastDev.Browser.isIE8) {
            global.picker.bind(&quot;dblclick&quot;, fastDev.setFnInScope(this, this.pickerClick));
        }
        // 绑定键盘相关操作
        global.picker.bind(&quot;keydown&quot;, fastDev.setFnInScope(this, this.pickerKeydown));
        if (fastDev.Browser.isIE6) {
            // IE6不支持keydown捕获回车事件，改用keyup监听
            global.picker.bind(&quot;keyup&quot;, function (event) {
                if (event.keyCode === 13) {
                    that.pickerKeydown(event);
                }
            });
        }
        // 绑定鼠标滚轮滚动事件，以便快速翻页
        global.picker.bind(fastDev.Browser.isFirefox ? &quot;DOMMouseScroll&quot; : &quot;mousewheel&quot;, fastDev.setFnInScope(this, this.bodyMouseWheel));
        global.yearMenu.bind(fastDev.Browser.isFirefox ? &quot;DOMMouseScroll&quot; : &quot;mousewheel&quot;, fastDev.setFnInScope(this, this.yearMenuMouseWheel));
        global.monthMenu.bind(fastDev.Browser.isFirefox ? &quot;DOMMouseScroll&quot; : &quot;mousewheel&quot;, fastDev.setFnInScope(this, this.bodyMouseWheel));
        global.monthMenu.bind(&quot;click&quot;, function (event) {
            return that.menuClick(event, &quot;month&quot;);
        });
        global.yearMenu.bind(&quot;click&quot;, global.yearMenuClickHandle = function (event) {
            return that.menuClick(event, &quot;year&quot;);
        });
        if (fastDev.Browser.isIE6) {
            // IE6下不支持样式设置hover，需添加js事件
            global.monthMenu.bind(&quot;mouseover&quot;, fastDev.setFnInScope(global.monthMenu, this.menuOver)).bind(&quot;mouseout&quot;, fastDev.setFnInScope(global.monthMenu, this.menuOut));
            global.yearMenu.bind(&quot;mouseover&quot;, fastDev.setFnInScope(global.yearMenu, this.menuOver)).bind(&quot;mouseout&quot;, fastDev.setFnInScope(global.yearMenu, this.menuOut));
        }
        if (fastDev.Browser.isIE6 || fastDev.Browser.isIE7 || fastDev.Browser.isIE8) {
            global.yearMenu.bind(&quot;dblclick&quot;, global.yearMenuClickHandle);
        }
        // 面板点击默认取消事件冒泡
        global.cancelBubble = true;
        // 初始化清理标识
        global.clear = false;
    },
<span id='fastDev-Ui-DatePicker-method-triggerEvent'>    /**
</span>     * 触发器触发事件
     * @param {Event} event
     * @private
     */
    triggerEvent: function (event) {
        this.show();
        // 取消事件冒泡
        return this.stopBubble(event);
    },
<span id='fastDev-Ui-DatePicker-method-preventTextSelect'>    /**
</span>     * 阻止文本选择
     * @private
     */
    preventTextSelect: function () {
        var global = this._global;
        if (fastDev.Browser.isFirefox) {
            // 火狐下禁用日历面板文本选择
            global.picker.css(&quot;-moz-user-select&quot;, &quot;-moz-none&quot;);
            global.yearMenu.css(&quot;-moz-user-select&quot;, &quot;none&quot;);
        } else {
            // Chrome、IE禁用文本选择
            global.picker.elems[0].onselectstart = global.yearMenu.elems[0].onselectstart = global.monthMenu.elems[0].onselectstart = fastDev.setFnInScope(this, this.stopBubble);
            global.yearInput.elems[0].onselectstart = global.monthInput.elems[0].onselectstart = function () {
                // 年份与月份输入框应该拥有可选文本事件
                global.cancelBubble = false;
            };
            if (this._options.showTimePicker) {
                fastDev.each([&quot;Hours&quot;, &quot;Minutes&quot;, &quot;Seconds&quot;], function (idx, val) {
                    global[&quot;timePicker&quot; + val].elems[0].onselectstart = function () {
                        global.cancelBubble = !global[&quot;show&quot; + val];
                    };
                });
            }
        }
    },
<span id='fastDev-Ui-DatePicker-method-pickerOver'>    /**
</span>     * 日历面板鼠标悬浮事件代理
     * @param {Event} event
     * @private
     */
    pickerOver: function (event) {
        var options = this._options,
            global = this._global,
            target = fastDev(event.target),
            name = (target.attr(&quot;name&quot;) || target.prop(&quot;name&quot;) || &quot;&quot;).split(&quot;-&quot;);
        if (name[1] === global.sequence + &quot;&quot;) {
            // 日期项鼠标悬浮
            target.addClass(&quot;ui-datepicker-over&quot;);
            if (options.showLunarTips &amp;&amp; !target.prop(&quot;title&quot;)) {
                target.prop(&quot;title&quot;, this.showLunarTips(name));
            }
        } else {
            switch (name[0]) {
                // 上一年按钮鼠标悬浮事件
                case &quot;prevYearBtn&quot;:
                    // 下一年按钮鼠标悬浮事件
                case &quot;nextYearBtn&quot;:
                    // 上一月按钮鼠标悬浮事件
                case &quot;prevMonthBtn&quot;:
                    // 下一月按钮鼠标悬浮事件
                case &quot;nextMonthBtn&quot;:
                    target.parent().addClass(&quot;ui-datepicker-header-over&quot;);
                    break;
                    // 今天按钮悬浮
                case &quot;todayBtn&quot;:
                    // 确定按钮悬浮
                case &quot;confirmBtn&quot;:
                    // 清除按钮悬浮
                case &quot;cleanBtn&quot;:
                    target.prop(&quot;title&quot;, name[0] === &quot;cleanBtn&quot; ? &quot;&quot; : fastDev.Util.DateUtil.format(name[0] === &quot;todayBtn&quot; ? new Date() : new Date(global.year, global.month, global.forSelectDate, global.hours, global.minutes, global.seconds), options.format));
                    target.parent().parent().addClass(&quot;ui-button-over&quot;);
                    break;
                    // 时间选择器向上按钮点击事件
                case &quot;timePickerUpBtn&quot;:
                    // 时间选择器向下按钮点击事件
                case &quot;timePickerDownBtn&quot;:
                    target.parent().addClass(&quot;ui-numberbox-over&quot;);
            }
        }
        // 取消事件冒泡
        return this.stopBubble(event);
    },
<span id='fastDev-Ui-DatePicker-method-menuOver'>    /**
</span>     * 菜单鼠标悬浮事件，IE6兼容考虑
     * @param {Event} event
     * @private
     */
    menuOver: function (event) {
        if (event.target.tagName.toLowerCase() === &quot;a&quot;) {
            fastDev(event.target).addClass(&quot;ui-datepicker-menu-over&quot;);
        }
    },
<span id='fastDev-Ui-DatePicker-method-menuOut'>    /**
</span>     * 菜单鼠标移出事件，IE6兼容考虑
     * @param {Event} event
     * @private
     */
    menuOut: function (event) {
        this.find(&quot;.ui-datepicker-menu-over&quot;).removeClass(&quot;ui-datepicker-menu-over&quot;);
    },
<span id='fastDev-Ui-DatePicker-method-pickerOut'>    /**
</span>     * 日历面板鼠标移出事件代理
     * @param {Event} event
     * @private
     */
    pickerOut: function (event) {
        var global = this._global;
        global.body.find(&quot;.ui-datepicker-over&quot;).removeClass(&quot;ui-datepicker-over&quot;);
        global.header.find(&quot;.ui-datepicker-header-over&quot;).removeClass(&quot;ui-datepicker-header-over&quot;);
        global.toolbar.find(&quot;.ui-button-over&quot;).removeClass(&quot;ui-button-over&quot;);
        if (this._options.showTimePicker) {
            global.timePickerTrigger.find(&quot;.ui-numberbox-over&quot;).removeClass(&quot;ui-numberbox-over&quot;);
        }
        // 取消事件冒泡
        return this.stopBubble(event);
    },
<span id='fastDev-Ui-DatePicker-method-pickerClick'>    /**
</span>     * 日历面板鼠标点击事件
     * @param {Event} event
     * @private
     */
    pickerClick: function (event) {
        var options = this._options,
            global = this._global,
            target = fastDev(event.target),
            name = (target.attr(&quot;name&quot;) || target.prop(&quot;name&quot;) || &quot;&quot;).split(&quot;-&quot;);
        // 隐藏年、月份菜单层，未传值则表示需验证年、月份输入框的值
        this.hideMenu(&quot;month&quot;);
        this.hideMenu(&quot;year&quot;);
        // 验证时间选择器的值
        this.validateTime(name[0]);
        if (name[1] === global.sequence + &quot;&quot;) {
            // 日期值点选
            this.bodyClick(name, target, event);
        } else {
            switch (name[0]) {
                // 上一年按钮点击事件
                case &quot;prevYearBtn&quot;:
                    // 下一年按钮点击事件
                case &quot;nextYearBtn&quot;:
                    // 上一月按钮点击事件
                case &quot;prevMonthBtn&quot;:
                    // 下一月按钮点击事件
                case &quot;nextMonthBtn&quot;:
                    name = name[0].match(/(prev|next)(Year|Month)Btn/);
                    this.headerBtnClick(fastDev.Util.StringUtil.capitalize(name[1]), name[2].toLowerCase(), target.parent().hasClass(&quot;ui-datepicker-header-disabled&quot;));
                    break;
                    // 月份输入框点击事件
                case &quot;monthInput&quot;:
                    // 年份输入框点击事件
                case &quot;yearInput&quot;:
                    this.headerInputClick(name[0].match(/(month|year)Input/)[1]);
                    break;
                    // &quot;今天&quot;按钮点击事件
                case &quot;todayBtn&quot;:
                    // &quot;确定&quot;按钮点击事件
                case &quot;confirmBtn&quot;:
                    // &quot;清除&quot;按钮点击事件
                case &quot;cleanBtn&quot;:
                    this[name[0] + &quot;Click&quot;](event);
                    break;
                case &quot;timePickerUpBtn&quot;:
                    this.timePickerBtnClick(&quot;up&quot;);
                    break;
                case &quot;timePickerDownBtn&quot;:
                    this.timePickerBtnClick(&quot;down&quot;);
                    break;
                    // 时间选择器
                case &quot;timePickerHours&quot;:
                case &quot;timePickerMinutes&quot;:
                case &quot;timePickerSeconds&quot;:
                    this.timePickerFocus(name[0]);
                    break;
                default:
                    this.btnClickCount();
            }
        }
        if (options.display === &quot;inline&quot;) {
            // 行内模式时，点击日历面板，需清理未关闭的其他非行内模式的日历面板
            global.clear = true;
            // 取消阻止事件冒泡，以避免影响其他监听doc click的控件（实际上clear操作已经取消阻止事件冒泡了，此处作个Note而已）
            global.cancelBubble = false;
        }
        // 取消事件冒泡
        return this.stopBubble(event);
    },
<span id='fastDev-Ui-DatePicker-method-pickerKeydown'>    /**
</span>     * 监听按键触发事件
     * @param {Event} event
     * @private
     */
    pickerKeydown: function (event) {
        var global = this._global;
        if (event.keyCode === 13) {
            this.hideMenu(&quot;year&quot;, undefined, true);
            this.hideMenu(&quot;month&quot;, undefined, true);
            this.refreshDate(global.year, global.month);
        } else {
            var target = event.target;
            if (target === global.yearInput.elems[0]) {
                if (event.keyCode === 9) {
                    this.hideMenu(&quot;year&quot;, undefined, true);
                    this.refreshDate(global.year, global.month);
                    this.headerInputClick(&quot;month&quot;);
                } else {
                    this.setTimer(function () {
                        this.refreshYearMenu(parseInt(this._global.yearInput.prop(&quot;value&quot;), 10), true);
                    }, 10);
                    global.cancelBubble = false;
                }
            } else if (target === global.monthInput.elems[0]) {
                if (event.keyCode === 9) {
                    this.hideMenu(&quot;month&quot;, undefined, true);
                    this.refreshDate(global.year, global.month);
                    this.headerInputClick(&quot;year&quot;);
                } else {
                    global.cancelBubble = false;
                }
            } else if (this._options.showTimePicker &amp;&amp; /^timePicker([HMS].*)$/.test((target = fastDev(target)).prop(&quot;name&quot;))) {
                if (event.keyCode === 9) {
                    this.validateTime();
                    switch (RegExp.$1) {
                        case &quot;Hours&quot;:
                            this.timePickerFocus(global.timePickerMinutes.prop(&quot;disabled&quot;) ? &quot;timePickerSeconds&quot; : &quot;timePickerMinutes&quot;);
                            break;
                        case &quot;Minutes&quot;:
                            this.timePickerFocus(global.timePickerSeconds.prop(&quot;disabled&quot;) ? &quot;timePickerHours&quot; : &quot;timePickerSeconds&quot;);
                            break;
                        case &quot;Seconds&quot;:
                            this.timePickerFocus(global.timePickerHours.prop(&quot;disabled&quot;) ? &quot;timePickerMinutes&quot; : &quot;timePickerHours&quot;);
                    }
                } else if (event.keyCode === 38) {
                    this.setTimer(this.timePickerBtnClick, 25, &quot;up&quot;);
                } else if (event.keyCode === 40) {
                    this.setTimer(this.timePickerBtnClick, 25, &quot;down&quot;);
                } else {
                    global.cancelBubble = false;
                }
            } else {
                global.cancelBubble = false;
            }
            return this.stopBubble(event);
        }
    },
<span id='fastDev-Ui-DatePicker-method-refreshDate'>    /**
</span>     * 刷新日期
     * @param {Number} year
     * @param {Number} month
     * @private
     */
    refreshDate: function (year, month) {
        var options = this._options,
            global = this._global,
            lastDay = new Date(year, month + 1, 0).getDate(),
            date = options.showTimePicker ? global.forSelectDate &gt; lastDay ? lastDay : global.forSelectDate : global.date &gt; lastDay ? lastDay : global.date;
        this.refreshToRecent(options.showTimePicker ? new Date(year, month, date, global.hours, global.minutes, global.seconds) : new Date(year, month, date));
    },
<span id='fastDev-Ui-DatePicker-method-setTimer'>    /**
</span>     * 设置计时器
     * @param {Function} func 函数
     * @param {Number} timeout 超时时长
     * @param {Object} parama 参数a
     * @param {Object} paramb 参数b
     * @private
     */
    setTimer: function (func, timeout, parama, paramb) {
        var that = this,
            global = this._global;
        window.clearTimeout(global.timer);
        global.timer = window.setTimeout(function () {
            func.call(that, parama, paramb);
        }, timeout);
    },
<span id='fastDev-Ui-DatePicker-method-bodyClick'>    /**
</span>     * 日期格子点击事件
     * @param {Array} name
     * @param {Element} target
     * @param {Event} event
     * @private
     */
    bodyClick: function (name, target, event) {
        var options = this._options,
            global = this._global,
            month = name[2] === &quot;prev&quot; ? global.month - 1 : name[2] === &quot;next&quot; ? global.month + 1 : global.month,
            year = month &lt; 0 ? global.year - 1 : month &gt; 11 ? global.year + 1 : global.year,
            date = new Date(year, month = month &lt; 0 ? 11 : month &gt; 11 ? 0 : month, name[0]),
            needFresh;
        if (options.display === &quot;block&quot;) {
            if (!options.showTimePicker) {
                // 有时间选择器的时候，需通过点击文档来关闭日历面板
                // 非行内模式则清理并隐藏日历面板
                global.forSelectDate = null;
                // 选取日期时间值并刷新输入框
                this.select(date);
                this.documentClick(event);
            } else {
                this.forSelect(date.getDate(), month, year);
                // 点击日期在上月或下月，则刷新面板
                needFresh = name[2];
            }
        } else {
            needFresh = this.select(date);
        }
        if (needFresh) {
            global.forSelectDate = date.getDate();
            global.year = year;
            global.month = month;
            this.refreshHeader();
            this.refreshBody();
        }
        this.btnClickCount();
    },
<span id='fastDev-Ui-DatePicker-method-bodyMouseWheel'>    /**
</span>     * 鼠标滚轮滚动翻页事件
     * @param {Event} event
     * @private
     */
    bodyMouseWheel: function (event) {
        var global = this._global,
            direct = event.wheelDelta || -event.detail;
        this.hideMenu(&quot;year&quot;);
        this.hideMenu(&quot;month&quot;);
        if (this._options.showTimePicker &amp;&amp; (global.timePicker.contains(event.target) || global.timePicker.elems[0] === event.target)) {
            this.setTimer(this.timePickerBtnClick, 15, direct &gt; 0 ? &quot;up&quot; : &quot;down&quot;);
        } else if (global.body.contains(event.target)) {
            this.headerBtnClick(direct &gt; 0 ? &quot;Prev&quot; : &quot;Next&quot;, &quot;month&quot;);
        }
        this.btnClickCount();
        this.cancelBubble = true;
        return this.stopBubble(event);
    },
<span id='fastDev-Ui-DatePicker-method-yearMenuMouseWheel'>    /**
</span>     * 鼠标滚轮滚动翻页&quot;年&quot;事件
     * @param {Event} event
     * @private
     */
    yearMenuMouseWheel: function (event) {
        var direct = event.wheelDelta || -event.detail;
        this.btnClickCount();
        this.yearMenuPaging(direct &gt; 0 ? &quot;Prev&quot; : &quot;Next&quot;);
        this.cancelBubble = true;
        return this.stopBubble(event);
    },
<span id='fastDev-Ui-DatePicker-method-headerBtnClick'>    /**
</span>     * 上下年月份按钮点击事件
     * @param {String} name Next或Prev
     * @param {String} type year或者month
     * @param {Boolean} disabled 是否被禁用
     * @private
     */
    headerBtnClick: function (name, type, disabled) {
        if (disabled) {
            this.btnClickCount();
            return;
        }
        var global = this._global,
            options = this._options,
            time;
        if (type === &quot;year&quot;) {
            do {
                time = this.getUsableYear(name, global.year);
            } while (time.month === null);
        } else {
            time = this.getUsableMonth(name, global.year, global.month);
        }
        this.refreshDate(time.year, time.month);
        this.btnClickCount(type);
    },
<span id='fastDev-Ui-DatePicker-method-headerInputClick'>    /**
</span>     * 年月份输入框点击事件
     * @param {String} type year或month
     * @private
     */
    headerInputClick: function (type) {
        var global = this._global,
            cType = fastDev.Util.StringUtil.capitalize(type),
            elem;
        this.btnClickCount();
        if (global[&quot;is&quot; + cType + &quot;MenuShowed&quot;]) {
            return;
        }
        global[type + &quot;Input&quot;].addClass(&quot;ui-datepicker-header-input-over&quot;).prop(&quot;value&quot;, global[type] + (type === &quot;year&quot; ? 0 : 1));
        this.position(global[type + &quot;Menu&quot;], global[type + &quot;Input&quot;]).show();
        if (type === &quot;year&quot;) {
            global.pageYear = global.year;
        } else {
            global.monthMenu.find(&quot;.ui-datepicker-menu-selected&quot;).removeClass(&quot;ui-datepicker-menu-selected&quot;);
            global.monthMenu.find(&quot;[name='&quot; + global.month + &quot;']&quot;).addClass(&quot;ui-datepicker-menu-selected&quot;);
        }
        this[&quot;refresh&quot; + cType + &quot;Menu&quot;]();
        (elem = global[type + &quot;Input&quot;].elems[0]).select();
        elem.focus();
        global[&quot;is&quot; + cType + &quot;MenuShowed&quot;] = true;
    },
<span id='fastDev-Ui-DatePicker-method-todayBtnClick'>    /**
</span>     * “今天”按钮点击事件
     * @param {Event} event
     * @private
     */
    todayBtnClick: function (event) {
        if (!this._global.todayBtn.attr(&quot;forbidden&quot;)) {
            this.select(new Date());
            // 点击&quot;今天&quot;按钮，则直接选取今天
            this.documentClick(event);
        } else {
            this.btnClickCount();
        }
    },
<span id='fastDev-Ui-DatePicker-method-confirmBtnClick'>    /**
</span>     * “确定”按钮点击事件
     * @param {Event} event
     * @private
     */
    confirmBtnClick: function (event) {
        var global = this._global;
        if (global.forSelectDate) {
            this.validateTime();
            this.select(new Date(global.year, global.month, global.forSelectDate, global.hours, global.minutes, global.seconds));
        }
        this.documentClick(event);
    },
<span id='fastDev-Ui-DatePicker-method-cleanBtnClick'>    /**
</span>     * “清除”按钮点击事件
     * @param {Event} event
     * @private
     */
    cleanBtnClick: function (event) {
        var global = this._global;
        // 清理并隐藏日历面板
        this.documentClick(event);
        this.setValue(&quot;&quot;);
    },
<span id='fastDev-Ui-DatePicker-method-menuClick'>    /**
</span>     * 菜单点击事件
     * @param {Event} event
     * @param {String} type year或month
     * @private
     */
    menuClick: function (event, type) {
        var global = this._global,
            target = fastDev(event.target),
            name = target.prop(&quot;name&quot;),
            time = parseInt(name, 10);
        this.btnClickCount();
        if (target.hasClass(&quot;ui-datepicker-disabled&quot;)) {
            // 被禁用
        } else if (typeof time === &quot;number&quot; &amp;&amp; !isNaN(time)) {
            this.refreshDate(type === &quot;year&quot; ? time : global.year, type === &quot;year&quot; ? global.month : time);
            this.hideMenu(type, time, true);
        } else if (type === &quot;year&quot; &amp;&amp; (name === &quot;prev&quot; || name === &quot;next&quot;)) {
            // 上下翻页
            this.yearMenuPaging(fastDev.Util.StringUtil.capitalize(name));
        }
        // 取消事件冒泡
        return this.stopBubble(event);
    },
<span id='fastDev-Ui-DatePicker-method-yearMenuPaging'>    /**
</span>     * 年份菜单上下翻页
     * @param {String} type Next或Prev
     * @private
     */
    yearMenuPaging: function (type) {
        var global = this._global,
            year = this.getUsableYear(type, global.pageYear + (type === &quot;Next&quot; ? 4 : -5)).year;
        if (type === &quot;Next&quot; ? year &lt;= global.maxYear &amp;&amp; global.pageYear !== year + 5 : year &gt;= global.minYear &amp;&amp; global.pageYear !== year - 4) {
            global.pageYear = year + (type === &quot;Next&quot; ? 5 : -4);
            global[&quot;yearMenu&quot; + (type === &quot;Next&quot; ? &quot;Prev&quot; : &quot;Next&quot;) + &quot;Btn&quot;].removeClass(&quot;ui-datepicker-disabled&quot;);
            this.refreshYearMenu();
        }
        // 到达最值，禁用按钮
        if (year === global[type === &quot;Next&quot; ? &quot;maxYear&quot; : &quot;minYear&quot;]) {
            global[&quot;yearMenu&quot; + type + &quot;Btn&quot;].addClass(&quot;ui-datepicker-disabled&quot;);
            global.yearMenuLine.addClass(&quot;ui-datepicker-disabled&quot;);
        } else {
            global.yearMenuLine.removeClass(&quot;ui-datepicker-disabled&quot;);
        }
    },
<span id='fastDev-Ui-DatePicker-method-timePickerFocus'>    /**
</span>     * 时间选择器聚焦事件
     * @param {String} name 输入框名
     * @private
     */
    timePickerFocus: function (name) {
        var global = this._global;
        if (!global[name].prop(&quot;disabled&quot;)) {
            (global.timePickerInputFocus || global[name]).removeClass(&quot;ui-datepicker-change&quot;);
            (global.timePickerInputFocus = global[name]).addClass(&quot;ui-datepicker-change&quot;);
            global[name].elems[0].select();
            global[name].elems[0].focus();
        } else {
            (global.timePickerInputFocus || global[name]).elems[0].blur();
        }
    },
<span id='fastDev-Ui-DatePicker-method-validateTime'>    /**
</span>     * 验证时间选择器输入框的时间值是否有效
     * @param {String} name 不传name值则表示非增减时间按钮点击
     * @private
     */
    validateTime: function (name) {
        if (this._options.showTimePicker) {
            var global = this._global,
                focus = global.timePickerInputFocus,
                // 获取所有时间输入框的当前值
                time = this.getTime(name);
            fastDev.apply(global, time);
            this.refreshTimePicker();
        }
    },
<span id='fastDev-Ui-DatePicker-method-timePickerBtnClick'>    /**
</span>     * 时间选择器按钮点击事件
     * @param {String} name 按钮名称
     * @private
     */
    timePickerBtnClick: function (name) {
        var global = this._global,
            focus = global.timePickerInputFocus || global.timePickerHours,
            time = focus.prop(&quot;name&quot;)
                .split(&quot;timePicker&quot;)[1].toLowerCase(),
            value = parseInt(focus.prop(&quot;value&quot;), 10) || 0,
            // 时钟点击
            hours = time === &quot;hours&quot; ? value : global.hours,
            // 分钟点击
            minutes = time === &quot;minutes&quot; ? value : global.minutes,
            // 秒种点击
            seconds = time === &quot;seconds&quot; ? value : global.seconds;
        time = global.timePickerInputFocus ? time : &quot;&quot;;
        time = name === &quot;up&quot; ? this.getNextTime(hours, minutes, seconds, time) : this.getPrevTime(hours, minutes, seconds, time);
        global.hours = time[0];
        global.minutes = time[1];
        global.seconds = time[2];
        this.refreshTimePicker();
    },
<span id='fastDev-Ui-DatePicker-method-getTimeFocusName'>    /**
</span>     * 获取时间选择器聚焦输入框的名称
     * @private
     */
    getTimeFocusName: function () {
        var focus = this._global.timePickerInputFocus;
        return focus ? focus.prop(&quot;name&quot;).split(&quot;timePicker&quot;)[1].toLowerCase() : &quot;&quot;;
    },
<span id='fastDev-Ui-DatePicker-method-documentClick'>    /**
</span>     * 文档点击事件
     * @param {Event} event
     * @private
     */
    documentClick: function (event) {
        var options = this._options,
            global = this._global;
        this.btnClickCount();
        if (event.target === global.input.elems[0] || !global.isPickerShowed || options.display === &quot;inline&quot; || global.clear) {
            if (options.display === &quot;inline&quot; &amp;&amp; !global.clear) {
                // 如果是清理操作，则跳过下面，以确保不会被自己给清理
                // 隐藏菜单时会根据已选值是否改变来刷新日历面板
                this.hideMenu(&quot;month&quot;);
                this.hideMenu(&quot;year&quot;);
            }
            global.clear = false;
            return;
        }
        if (options.display === &quot;block&quot;) {
            this.hide();
        }
    },
<span id='fastDev-Ui-DatePicker-method-stopBubble'>    /**
</span>     * 阻止事件冒泡
     * @param {Event} event
     * @private
     */
    stopBubble: function (event) {
        var global = this._global;
        if (!global.cancelBubble || global.clear) {
            // 非取消事件冒泡或者处于清理状态则返回
            global.cancelBubble = true;
            return;
        }
        fastDev.Event.stopBubble(event);
        return false;
    },
<span id='fastDev-Ui-DatePicker-method-btnClickCount'>    /**
</span>     * 按钮点击计数
     * 若连续点击某类按钮5次则弹出相应菜单
     * @param {String} name 按钮名
     * @private
     */
    btnClickCount: function (name) {
        var global = this._global,
            clickCount = global[name + &quot;BtnClickCount&quot;] || 0;
        if (name !== &quot;year&quot;) {
            global.yearBtnClickCount = 0;
        }
        if (name !== &quot;month&quot;) {
            global.monthBtnClickCount = 0;
        }
        if (!name) {
            return;
        }
        if (++clickCount === 5) {
            // 5次连续点击则自动弹出选择菜单
            global[name + &quot;BtnClickCount&quot;] = 0;
            this.headerInputClick(name);
        } else {
            global[name + &quot;BtnClickCount&quot;] = clickCount;
        }
    },
<span id='fastDev-Ui-DatePicker-method-generateBody'>    /**
</span>     * 生成日历面板HTML
     * @param {Number} year 年份
     * @param {Number} month 月份
     * @return {String}
     * @private
     */
    generateBody: function (year, month) {
        var day, cls, disabled, body = [],
            global = this._global,
            today = new Date(),
            sysYear = today.getFullYear(),
            sysMonth = today.getMonth(),
            sysDay = today.getDate(),
            // 上月
            prevMonth = month === 0 ? 11 : month - 1,
            // 上月所在的年
            prevMonthYear = prevMonth === month - 1 ? year : year - 1,
            // 下月
            nextMonth = month === 11 ? 0 : month + 1,
            // 下月所在的年
            nextMonthYear = nextMonth === month + 1 ? year : year + 1,
            // 该月的第一天在星期几（0~6）
            firstDay = new Date(year, month, 1).getDay(),
            // 上月的总天数
            daysInPreMonth = new Date(year, month, 0).getDate(),
            // 该月的总天数
            daysInMonth = new Date(year, month + 1, 0).getDate(),
            // 每周的第一天
            firstDayOfWeek = this._options.firstDayOfWeek,
            // 日历面板上显示的属于上月日子的天数（第一天现默认以星期日开始）
            daysFromPreMonth = firstDay - firstDayOfWeek;
        // 保证总是有上月日子显示，更加符合习惯，也更加对称美观
        daysFromPreMonth = daysFromPreMonth === 0 ? 7 : daysFromPreMonth &lt; 0 ? daysFromPreMonth + 7 : daysFromPreMonth;
        body.push(&quot;&lt;tr&gt;&quot;);
        for (var i = 0, j; i &lt; 42; i++) {
            if (i &gt; 0 &amp;&amp; i % 7 === 0) {
                body.push(&quot;&lt;/tr&gt;&lt;tr&gt;&quot;);
            }
            // 周末样式
            if ((j = (firstDayOfWeek + i) % 7) === 0 || j === 6) {
                cls = &quot;ui-datepicker-holiday&quot;;
            } else {
                cls = &quot;&quot;;
            }
            disabled = false;
            if (i &lt; daysFromPreMonth) {
                // 上月日子
                cls += &quot; ui-datepicker-other&quot;;
                day = daysInPreMonth - daysFromPreMonth + i + 1;
                if (this.isDisabled(prevMonthYear, prevMonth, day)) {
                    // 被禁用
                    cls += &quot; ui-datepicker-disabled&quot;;
                    disabled = true;
                }
                body.push('&lt;td ' + (disabled ? &quot;&quot; : 'name=&quot;' + day + &quot;-&quot; + global.sequence + '-prev&quot;') + ' class=&quot;' + cls + '&quot;&gt;' + day + '&lt;/td&gt;');
            } else if ((day = i - daysFromPreMonth + 1) &gt; daysInMonth) {
                // 下月日子
                day = day - daysInMonth;
                cls += &quot; ui-datepicker-other&quot;;
                if (this.isDisabled(nextMonthYear, nextMonth, day)) {
                    // 被禁用
                    cls += &quot; ui-datepicker-disabled&quot;;
                    disabled = true;
                }
                body.push('&lt;td ' + (disabled ? &quot;&quot; : 'name=&quot;' + day + &quot;-&quot; + global.sequence + '-next&quot;') + ' class=&quot;' + cls + '&quot;&gt;' + day + '&lt;/td&gt;');
            } else {
                // 当前月日子
                if (day === sysDay &amp;&amp; month === sysMonth &amp;&amp; year === sysYear) {
                    // 今天
                    cls += &quot; ui-datepicker-today&quot;;
                }
                if (this.isDisabled(year, month, day)) {
                    // 被禁用
                    cls += &quot; ui-datepicker-disabled&quot;;
                    disabled = true;
                } else if (this.isSelected(year, month, day)) {
                    // 已选择值
                    cls += &quot; ui-datepicker-selected&quot;;
                }
                body.push('&lt;td ' + (disabled ? &quot;&quot; : 'name=&quot;' + day + &quot;-&quot; + global.sequence + '&quot;') + ' class=&quot;' + cls + '&quot;&gt;' + day + '&lt;/td&gt;');
            }
        }
        body.push(&quot;&lt;/tr&gt;&quot;);
        return body.join(&quot;&quot;);
    },
<span id='fastDev-Ui-DatePicker-method-refreshYearMenu'>    /**
</span>     * 刷新年份菜单
     * @param {Number} year 当前选择年份
     * @param {Boolean} highlight 高亮传参年份
     * @private
     */
    refreshYearMenu: function (year, highlight) {
        var global = this._global,
            menu = [],
            selectedYear;
        year = (year &amp;&amp; year &lt; 9996 &amp;&amp; year &gt; 1004) ? year : year === undefined ? global.pageYear : global.year;
        global.pageYear = year;
        selectedYear = highlight ? this.isDisabled(year) ? undefined : year : global.year;
        for (var y = year - 5; y &lt; year + 5; y++) {
            menu.push('&lt;a name=&quot;' + y + '&quot; class=&quot;' + (y === selectedYear ? &quot;ui-datepicker-menu-selected&quot; : this.isDisabled(y) ? &quot; ui-datepicker-disabled&quot; : &quot;&quot;) + '&quot;&gt;' + y + '&lt;/a&gt;');
        }
        global.yearMenuPlaceHolder.empty()
            .elems[0].innerHTML = menu.join(&quot;&quot;);
        global.yearMenu.find(&quot;.ui-datepicker-menu-year-page&quot;).find(&quot;.ui-datepicker-disabled&quot;).removeClass(&quot;ui-datepicker-disabled&quot;);
    },
<span id='fastDev-Ui-DatePicker-method-refreshMonthMenu'>    /**
</span>     * 刷新月份菜单
     * @param {Number} month 当前月份(0~11)
     * @private
     */
    refreshMonthMenu: function (month) {
        var locale = [&quot;一月&quot;, &quot;二月&quot;, &quot;三月&quot;, &quot;四月&quot;, &quot;五月&quot;, &quot;六月&quot;, &quot;七月&quot;, &quot;八月&quot;, &quot;九月&quot;, &quot;十月&quot;, &quot;十一&quot;, &quot;十二&quot;],
            global = this._global,
            menu = [];
        month = month || global.month;
        for (var m = 0; m &lt; 12; m++) {
            menu.push('&lt;a name=&quot;' + m + '&quot; class=&quot;' + (m === global.month ? &quot;ui-datepicker-menu-selected&quot; : this.isDisabled(global.year, m) ? &quot; ui-datepicker-disabled&quot; : &quot;&quot;) + '&quot;&gt;' + locale[m] + '&lt;/a&gt;');
        }
        global.monthMenu.empty()
            .elems[0].innerHTML = menu.join(&quot;&quot;);
    },
<span id='fastDev-Ui-DatePicker-method-refreshBody'>    /**
</span>     * 刷新日历面板
     * @param {Number} year
     * @param {Number} month(0~11)
     * @private
     */
    refreshBody: function (year, month) {
        var global = this._global,
            body = global.body,
            tbody = this.generateBody(year || global.year, parseInt(month || global.month, 10));
        // 清理DOM
        body.empty();
        if (fastDev.Browser.isIE) {
            // IE下table的innerHTML为只读属性
            var div = document.createElement(&quot;div&quot;);
            div.innerHTML = &quot;&lt;table&gt;&lt;tbody&gt;&quot; + tbody + &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;;
            global.body = fastDev(div).find(&quot;tbody&quot;).replace(body);
        } else {
            body.elems[0].innerHTML = tbody;
        }
        // 刷新&quot;今天&quot;按钮
        this.freshUI(true);
    },
<span id='fastDev-Ui-DatePicker-method-refreshHeader'>    /**
</span>     * 刷新日历头部样式
     * @param {Number} year 年份
     * @param {Number} month 月份(0~11)
     * @private
     */
    refreshHeader: function (year, month) {
        var global = this._global;
        global.yearInput.removeClass(&quot;ui-datepicker-header-input-over&quot;).prop(&quot;value&quot;, this.toLocaleYear(year || global.year));
        global.monthInput.removeClass(&quot;ui-datepicker-header-input-over&quot;).prop(&quot;value&quot;, this.toLocaleMonth(month || global.month));
        this.refreshHeaderBtn();
    },
<span id='fastDev-Ui-DatePicker-method-refreshHeaderBtn'>    /**
</span>     * 刷新日历头部按钮样式
     * @param {Number} year 当前年份
     * @param {Number} month 当前月份
     * @private
     */
    refreshHeaderBtn: function (year, month) {
        var global = this._global;
        year = year || global.year;
        month = month || global.month;
        global.header.find(&quot;.ui-datepicker-header-disabled&quot;).removeClass(&quot;ui-datepicker-header-disabled&quot;);
        if (year === global.maxYear) {
            global.nextYearBtn.parent().addClass(&quot;ui-datepicker-header-disabled&quot;);
            if (month === global.maxMonth) {
                global.nextMonthBtn.parent().addClass(&quot;ui-datepicker-header-disabled&quot;);
            }
        }
        if (year === global.minYear) {
            global.prevYearBtn.parent().addClass(&quot;ui-datepicker-header-disabled&quot;);
            if (month === global.minMonth) {
                global.prevMonthBtn.parent().addClass(&quot;ui-datepicker-header-disabled&quot;);
            }
        }
    },
<span id='fastDev-Ui-DatePicker-method-refreshToRecent'>    /**
</span>     * 刷新至较近可用时间点
     * @param {Date} date
     * @private
     */
    refreshToRecent: function (date) {
        var global = this._global,
            options = this._options,
            oldYear = global.year,
            oldMonth = global.month,
            oldDate = global.date,
            now, year, month, last, time;
        if (!global.selectedYear) {
            // 以指定日期或当前日期点刷新
            now = date || new Date();
        } else {
            // 以指定日期或已选择日期点刷新
            now = date || global.selectedValue;
            global.hours = now.getHours();
            global.minutes = now.getMinutes();
            global.seconds = now.getSeconds();
        }
        date = new Date(now.getFullYear(), now.getMonth() - 1);
        year = date.getFullYear();
        month = date.getMonth();
        time = this.getUsableMonth(&quot;Next&quot;, year, month);
        if (time.month === month) {
            time = this.getUsableMonth(&quot;Prev&quot;, now.getFullYear(), now.getMonth());
        }
        global.year = year = time.year;
        global.month = month = time.month;
        global.date = date = now.getDate();
        if (options.showTimePicker) {
            // 确定当前待选日可用
            last = new Date(year, month + 1, 0).getDate();
            while (this.isDisabled(year, month, date) &amp;&amp; !! date) {
                date = date &gt;= global.date ? date === last ? global.date - 1 : date + 1 : date - 1;
            }
            global.date = global.forSelectDate = date === 0 ? global.date : date;
            // 刷新待选日样式
            this.forSelect(global.forSelectDate);
        } else {
            global.forSelectDate = global.selectedDate;
        }
        // 刷新头部
        this.refreshHeader();
        // 刷新面板
        this.refreshBody();
        if (options.showTimePicker) {
            // 获取最近整点
            if (global.hours === undefined || global.hours === null) {
                time = this.getNextTime(now.getHours(), now.getMinutes(), now.getSeconds(), this.getTimeFocusName());
            } else if (this.isDisabled(global.year, global.month, global.forSelectDate, global.hours, global.minutes, global.seconds)) {
                time = this.getNextTime(global.hours, global.minutes, global.seconds, this.getTimeFocusName());
            } else {
                time = null;
            }
            if (time !== null) {
                global.hours = time[0] || 0;
                global.minutes = time[1] || 0;
                global.seconds = time[2] || 0;
            }
            this.refreshTimePicker();
        }
    },
<span id='fastDev-Ui-DatePicker-method-setWeekdayTitle'>    /**
</span>     * 设置星期标题
     * @param {Number} firstDay 每周的第一天
     * @private
     */
    setWeekdayTitle: function (firstDay) {
        var td = &quot;&lt;td&gt;&quot;,
            isIE = fastDev.Browser.isIE,
            weekdayTitle = this._global.weekdayTitle.elems[0],
            title = [&quot;日&quot;, &quot;一&quot;, &quot;二&quot;, &quot;三&quot;, &quot;四&quot;, &quot;五&quot;, &quot;六&quot;];
        for (var i = firstDay || this._options.firstDayOfWeek, j = 0; j &lt; 7; j++, i++) {
            i = i &gt; 6 ? 0 : i;
            if (isIE) {
                //IE下table的innerHTML为只读属性
                td = document.createElement(&quot;td&quot;);
                td.appendChild(document.createTextNode(title[i]));
                weekdayTitle.appendChild(td);
            } else {
                if (j &gt; 0) {
                    td += &quot;&lt;/td&gt;&lt;td&gt;&quot;;
                }
                td += title[i];
            }
        }
        if (!isIE) {
            weekdayTitle.innerHTML = td + &quot;&lt;/td&gt;&quot;;
        }
    },
<span id='fastDev-Ui-DatePicker-method-hideMenu'>    /**
</span>     * 隐藏菜单
     * @param {String} type year或month
     * @param {Number} time 当前年月值，月份值(1~12)
     * @param {Boolean} noFresh 是否不刷新
     * @private
     */
    hideMenu: function (type, time, noFresh) {
        var global = this._global,
            cType = fastDev.Util.StringUtil.capitalize(type);
        if (global[&quot;is&quot; + cType + &quot;MenuShowed&quot;]) {
            if (time === undefined) {
                //验证输入框输入
                time = parseInt(global[type + &quot;Input&quot;].prop(&quot;value&quot;), 10) || -1;
                time = type === &quot;year&quot; ? (time &gt;= global.minYear &amp;&amp; time &lt;= global.maxYear &amp;&amp; !this.isDisabled(time)) ? time : global.year : (time &gt; 0 &amp;&amp; time &lt; 13 &amp;&amp; !this.isDisabled(global.year, time - 1)) ? time - 1 : global.month;
            }
            global[type] = time;
            if (!noFresh) {
                this.refreshBody(global.year, global.month + &quot;&quot;);
            }
            this.refreshHeader(global.year, global.month + &quot;&quot;);
            global[type + &quot;Input&quot;].elems[0].blur();
            global[type + &quot;Menu&quot;].hide();
            global[&quot;is&quot; + cType + &quot;MenuShowed&quot;] = false;
        }
    },
<span id='fastDev-Ui-DatePicker-method-getUsableYear'>    /**
</span>     * 获取可用年份
     * @param {String} type Next或Prev
     * @param {Number} year 当前年份
     * @param {Boolean} forMonth 是否是获取月份操作
     * @return {Object}
     * @private
     */
    getUsableYear: function (type, year, forMonth) {
        var global = this._global,
            extremum = global[type === &quot;Next&quot; ? &quot;maxYear&quot; : &quot;minYear&quot;],
            month = global.month,
            maxLoopCount = 2000;
        year = type === &quot;Next&quot; ? year &gt;= extremum ? extremum - 1 : year : year &lt;= extremum ? extremum + 1 : year;
        while (type === &quot;Next&quot; ? ++year &lt; extremum : --year &gt; extremum) {
            if (!this.isDisabled(year)) {
                //可用年份
                // 如果当前月份被禁用，则获取当前年的上或下一个可用月份
                if (!forMonth &amp;&amp; this.isDisabled(year, month)) {
                    while (type === &quot;Next&quot; ? --month &gt; -1 : ++month &lt; 12) {
                        if (!this.isDisabled(year, month)) {
                            break;
                        } else if (month === (type === &quot;Next&quot; ? 0 : 11)) {
                            // 获取当前年下或上一个可用的月份
                            month = global.month;
                            while (type === &quot;Next&quot; ? ++month &lt; 12 : --month &gt; -1) {
                                if (!this.isDisabled(year, month)) {
                                    break;
                                } else if (month === (type === &quot;Next&quot; ? 11 : 0)) {
                                    // 当前年根本无可用的月份
                                    month = null;
                                    break;
                                }
                            }
                            break;
                        }
                    }
                }
                break;
            }
            if (!(maxLoopCount--)) {
                break;
            }
        }
        return maxLoopCount ? {
            year: year,
            month: month
        } : {
            year: global[type === &quot;Next&quot; ? &quot;maxYear&quot; : &quot;minYear&quot;],
            month: global[type === &quot;Next&quot; ? &quot;maxMonth&quot; : &quot;minMonth&quot;]
        };
    },
<span id='fastDev-Ui-DatePicker-method-getUsableMonth'>    /**
</span>     * 获取可用月份
     * @param {String} type Next或Prev
     * @param {Number} year 当前年份
     * @param {Number} month 当前月份(0~11)
     * @private
     */
    getUsableMonth: function (type, year, month) {
        var global = this._global,
            usableYear, temp = month,
            maxLoopCount = 2000;
        while (maxLoopCount--) {
            if (month === (type === &quot;Prev&quot; ? 0 : 11)) {
                // 获取下一个可用年份
                if ((usableYear = this.getUsableYear(type, year, true).year) === year) {
                    month = temp;
                    break;
                }
                year = usableYear;
                month = (type === &quot;Prev&quot; ? 11 : 0);
            } else {
                month += (type === &quot;Prev&quot; ? -1 : 1);
            }
            if (!this.isDisabled(year, month)) {
                break;
            }
        }
        return maxLoopCount ? {
            year: year,
            month: month
        } : {
            year: global[type === &quot;Prev&quot; ? &quot;minYear&quot; : &quot;maxYear&quot;],
            month: global[type === &quot;Prev&quot; ? &quot;minMonth&quot; : &quot;maxMonth&quot;]
        };
    },
<span id='fastDev-Ui-DatePicker-method-getNextTime'>    /**
</span>     * 获取当前时间的下一个较近的可选时间值
     * @param {Number} hours
     * @param {Number} minutes
     * @param {Number} seconds
     * @param {String} focus
     * @param {Array} original 原值
     * @private
     */
    getNextTime: function (hours, minutes, seconds, focus, original) {
        var global = this._global,
            sPlus = global.showSeconds &amp;&amp; (!focus || focus === &quot;seconds&quot; || !! original),
            mPlus = global.showMinutes &amp;&amp; (!focus || focus === &quot;minutes&quot; || !! original),
            hPlus = global.showHours &amp;&amp; (!focus || focus === &quot;hours&quot;),
            step = focus ? 1 : 15,
            args = Array.prototype.slice.call(arguments, 0, 3),
            prev = false,
            time;
        minutes = focus ? minutes : mPlus ? Math.floor(minutes / 15) * 15 : 0;
        seconds = focus ? seconds : sPlus ? !! original ? 0 : 45 : 0;
        if ( !! original &amp;&amp; !this.isDisabled(global.year, global.month, global.forSelectDate, hours, minutes, seconds)) {
            return [hours, minutes, seconds];
        }
        do {
            if (sPlus) {
                hPlus = ((mPlus = !(seconds = ((time = seconds + step) &lt; 60 ? time : 0)) &amp;&amp; global.showMinutes) || (!seconds &amp;&amp; !global.showMinutes)) &amp;&amp; global.showHours;
                if (seconds === 0 &amp;&amp; !hPlus &amp;&amp; !mPlus) {
                    prev = true;
                    break;
                }
            }
            if (mPlus &amp;&amp; !(hPlus = !(minutes = ((time = minutes + step) &lt; 60 ? time : 0)) &amp;&amp; global.showHours) &amp;&amp; minutes === 0) {
                prev = true;
                break;
            }
            if (hPlus &amp;&amp; !(hours = (hours &lt; 23 ? hours + 1 : 0))) {
                prev = true;
                break;
            }
            if ( !! original &amp;&amp; (hours &gt; original[0] || (hours === original[0] &amp;&amp; minutes &gt;= original[1]) || (hours === original[0] &amp;&amp; minutes === original[1] &amp;&amp; seconds &gt;= original[2]))) {
                return original;
            }
        } while (this.isDisabled(global.year, global.month, global.forSelectDate, hours, minutes, seconds));
        return prev ? original || this.getNextTime(hours, minutes, seconds, focus, args) : [hours, minutes, seconds];
    },
<span id='fastDev-Ui-DatePicker-method-getPrevTime'>    /**
</span>     * 获取当前时间的上一个较近的可选时间值
     * @param {Number} hours
     * @param {Number} minutes
     * @param {Number} seconds
     * @param {Array} original 原值
     * @private
     */
    getPrevTime: function (hours, minutes, seconds, focus, original) {
        var global = this._global,
            sPlus = focus ? global.showSeconds &amp;&amp; (focus === &quot;seconds&quot; || !! original) : false,
            mPlus = global.showMinutes &amp;&amp; (!focus || focus === &quot;minutes&quot; || !! original),
            hPlus = global.showHours &amp;&amp; (!focus || focus === &quot;hours&quot;),
            step = focus ? -1 : -15,
            args = Array.prototype.slice.call(arguments, 0, 3),
            next = false,
            time;
        minutes = focus ? minutes : mPlus ? Math.floor(minutes / 15) * 15 : 0;
        if ( !! original &amp;&amp; !this.isDisabled(global.year, global.month, global.forSelectDate, hours, minutes, seconds)) {
            return [hours, minutes, seconds];
        }
        do {
            if (sPlus) {
                if ((time = seconds + step) &lt; 0) {
                    seconds = 59;
                    if (!(mPlus = global.showMinutes) &amp;&amp; !(hPlus = global.showHours)) {
                        next = true;
                        break;
                    }
                } else {
                    seconds = time;
                    hPlus = mPlus = false;
                }
            }
            if (mPlus) {
                if ((time = minutes + step) &lt; 0) {
                    minutes = focus ? 59 : 45;
                    if (!(hPlus = global.showHours)) {
                        next = true;
                        break;
                    }
                } else {
                    minutes = time;
                    hPlus = false;
                }
            }
            if (hPlus) {
                if ((time = hours - 1) &lt; 0) {
                    hours = 23;
                    next = true;
                    break;
                } else {
                    hours = time;
                }
            }
            if ( !! original &amp;&amp; (hours &lt; original[0] || (hours === original[0] &amp;&amp; minutes &lt;= original[1]) || (hours === original[0] &amp;&amp; minutes === original[1] &amp;&amp; seconds &lt;= original[2]))) {
                return original;
            }
        } while (this.isDisabled(global.year, global.month, global.forSelectDate, hours, minutes, seconds));
        return next ? original || this.getPrevTime(hours, minutes, seconds, focus, args) : [hours, minutes, seconds];
    },
<span id='fastDev-Ui-DatePicker-method-isDisabled'>    /**
</span>     * 判断该日期是否被禁用
     * @param {Number|Date} year 年
     * @param {Number} month 月(0~11)
     * @param {Number} date 日
     * @param {Number} hours 时
     * @param {Number} minutes 分
     * @param {Number} seconds 秒
     * @return {Boolean}
     * @private
     */
    isDisabled: function (year, month, date, hours, minutes, seconds) {
        var that = this,
            options = that._options,
            global = this._global,
            includes = global.includes,
            excludes = global.excludes,
            time, disabled;
        hours = global.showHours ? hours : undefined;
        minutes = global.showMinutes ? minutes : undefined;
        seconds = global.showSeconds ? seconds : undefined;
        // 最值判断
        if (year === undefined) {
            disabled = true;
        } else if (month === undefined) {
            disabled = year &gt; global.maxYear || year &lt; global.minYear;
        } else if (date === undefined) {
            time = new Date(year, month).getTime();
            disabled = time &gt;= new Date(global.maxYear, global.maxMonth + 1).getTime() || time &lt; new Date(global.minYear, global.minMonth, 1).getTime();
        } else if (hours === undefined) {
            time = new Date(year, month, date).getTime();
            disabled = time &gt;= new Date(global.maxYear, global.maxMonth, global.maxDay + 1).getTime() || time &lt; new Date(global.minYear, global.minMonth, global.minDay).getTime();
        } else if (minutes === undefined) {
            time = new Date(year, month, date, hours).getTime();
            disabled = time &gt;= new Date(global.maxYear, global.maxMonth, global.maxDay, global.maxHours + 1).getTime() || time &lt; new Date(global.minYear, global.minMonth, global.minDay, global.minHours).getTime();
        } else if (seconds === undefined) {
            time = new Date(year, month, date, hours, minutes).getTime();
            disabled = time &gt;= new Date(global.maxYear, global.maxMonth, global.maxDay, global.maxHours, global.maxMinutes + 1).getTime() || time &lt; new Date(global.minYear, global.minMonth, global.minDay, global.minHours, global.minMinutes).getTime();
        } else {
            time = new Date(year, month, date, hours, minutes, seconds).getTime();
            disabled = time &gt;= new Date(global.maxYear, global.maxMonth, global.maxDay, global.maxHours, global.maxMinutes, global.maxSeconds + 1).getTime() || time &lt; new Date(global.minYear, global.minMonth, global.minDay, global.minHours, global.minMinutes, global.minSeconds).getTime();
        }
        // cron表达式判断
        if (!disabled) {
            time = {
                year: year,
                month: month,
                date: date,
                hours: hours,
                minutes: minutes,
                seconds: seconds
            };
            // 先判断排除
            fastDev.each(excludes || [], function (i, exclude) {
                if (that.contains(exclude, time, true)) {
                    return !(disabled = true);
                }
            });
            // 再判断包含
            if (!disabled) {
                fastDev.each(includes || [], function (i, include) {
                    // 如果含include声明，则拟定待判断值是需要disabled的
                    disabled = true;
                    if (that.contains(include, time)) {
                        return disabled = false;
                    }
                });
            }
        }
        return disabled;
    },
<span id='fastDev-Ui-DatePicker-method-contains'>    /**
</span>     * 判断表达式所指日期是否包含指定的日期值
     * @param {Object} items 已解析的表达式项
     * @param {Object} item 需验证的日期对象（POJO）
     * @param {Boolean} exclude 是否是exclude表达式判断
     * @return {Boolean}
     * @private
     */
    // 将此方法拆分子方法，一个方法273行不方便维护
    contains: function (items, item, exclude) {
        var that = this,
            Y = item.year,
            M = item.month,
            D = item.date,
            h = item.hours,
            m = item.minutes,
            s = item.seconds,
            isExcluded,
            // 需匹配的域个数
            length = items.length,
            // 初始限制
            yearLimit = true,
            monthLimit = true,
            dateLimit = true,
            dayLimit = true,
            weekLimit = true,
            hoursLimit = true,
            minutesLimit = true,
            secondsLimit = true;
        // 判断开始
        fastDev.each([&quot;Y&quot;, &quot;M&quot;, &quot;D&quot;, &quot;d&quot;, &quot;dc&quot;, &quot;h&quot;, &quot;m&quot;, &quot;s&quot;], function (i, name) {
            switch (name) {
                // 年
                case &quot;Y&quot;:
                    if (items[name] === undefined) {
                        if (exclude &amp;&amp; length === 0) {
                            // 排除操作，则检查是否还有其他域限制
                            // 不含子域声明，则确定需排除
                            return !(isExcluded = true);
                        }
                        // 匹配所有年份，继续往下判断
                        yearLimit = false;
                    } else {
                        length -= 1;
                        // 年份匹配
                        if (that.inArray(items[name], Y)) {
                            if (exclude &amp;&amp; length === 0) {
                                // 已确定需排除该年份值
                                isExcluded = true;
                            }
                            // 匹配成功则解除受限，然后继续匹配下一个域
                            yearLimit = false;
                        }
                    }
                    if (exclude) {
                        if (isExcluded) {
                            // 确定排除了则跳出
                            return false;
                        }
                        if (M === undefined &amp;&amp; length !== 0) {
                            // 匹配结束
                            return false;
                        }
                        // 匹配下一个子域
                        break;
                    }
                    if (yearLimit) {
                        // 未匹配到年份，则终止匹配
                        return false;
                    }
                    if (M === undefined || length === 0) {
                        // 匹配结束
                        return monthLimit = dateLimit = dayLimit = weekLimit = hoursLimit = minutesLimit = secondsLimit = false;
                    }
                    break;
                    // 月
                case &quot;M&quot;:
                    if (items[name] === undefined) {
                        // 匹配所有月份，继续往下判断
                        monthLimit = false;
                    } else {
                        length -= 1;
                        if (that.inArray(items[name], M + 1)) {
                            if (exclude &amp;&amp; length === 0 &amp;&amp; !yearLimit) {
                                // 此时已确定需要排除掉该月份
                                isExcluded = true;
                            }
                            monthLimit = false;
                        }
                    }
                    if (exclude) {
                        if (isExcluded) {
                            // 确定要排除掉，则跳出
                            return false;
                        }
                        if (D === undefined &amp;&amp; length !== 0) {
                            return false;
                        }
                        // 月份域未匹配成功，则继续匹配下一个子表达式
                        break;
                    }
                    if (monthLimit) {
                        // 未匹配到月份，则终止匹配
                        return false;
                    }
                    if (D === undefined || length === 0) {
                        // 匹配结束
                        return dateLimit = dayLimit = weekLimit = hoursLimit = minutesLimit = secondsLimit = false;
                    }
                    break;
                    // 日
                case &quot;D&quot;:
                    if (items[name] === undefined) {
                        // 匹配所有日，继续往下匹配
                        dateLimit = false;
                    } else {
                        length -= 1;
                        if (items[name][0] === 0) {
                            dateLimit = new Date(Y, M + 1, 0).getDate() !== D;
                            if (exclude &amp;&amp; !dateLimit &amp;&amp; !yearLimit &amp;&amp; !monthLimit &amp;&amp; length === 0) {
                                isExcluded = true;
                            }
                        } else if (that.inArray(items[name], D)) {
                            if (exclude &amp;&amp; length === 0 &amp;&amp; !yearLimit &amp;&amp; !monthLimit) {
                                // 确定要排除掉该日子
                                isExcluded = true;
                            }
                            dateLimit = false;
                        }
                    }
                    if (exclude) {
                        if (isExcluded) {
                            return false;
                        }
                        break;
                    }
                    if (dateLimit) {
                        return false;
                    }
                    if (length === 0) {
                        return dayLimit = weekLimit = hoursLimit = minutesLimit = secondsLimit = false;
                    }
                    break;
                    // 周
                case &quot;d&quot;:
                    if (items[name] !== undefined) {
                        length -= 1;
                        if (that.inArray(items[name], new Date(Y, M, D).getDay() + 1)) {
                            if (exclude &amp;&amp; length === 0 &amp;&amp; !yearLimit &amp;&amp; !monthLimit &amp;&amp; !dateLimit) {
                                isExcluded = true;
                            }
                            dayLimit = false;
                        }
                    } else {
                        dayLimit = false;
                    }
                    if (exclude) {
                        if (isExcluded) {
                            return false;
                        }
                        break;
                    }
                    if (dayLimit) {
                        return false;
                    }
                    if (length === 0) {
                        return weekLimit = hoursLimit = minutesLimit = secondsLimit = false;
                    }
                    break;
                    // 周数，0表示月份最后一周
                case &quot;dc&quot;:
                    if (items[name] !== undefined) {
                        length -= 1;
                        // 当前日所在周数限制
                        if (Math.floor((D - 1) / 7) + 1 === items[name][0]) {
                            if (exclude &amp;&amp; length === 0 &amp;&amp; !yearLimit &amp;&amp; !monthLimit &amp;&amp; !dateLimit &amp;&amp; !dayLimit) {
                                isExcluded = true;
                            }
                            weekLimit = false;
                        } else if (items[name][0] === 0) {
                            // 判断是否是在最后一周
                            weekLimit = D &lt;= new Date(Y, M + 1, 0).getDate() - 7;
                            if (exclude &amp;&amp; !weekLimit &amp;&amp; length === 0 &amp;&amp; !yearLimit &amp;&amp; !monthLimit &amp;&amp; !dateLimit &amp;&amp; !dayLimit) {
                                isExcluded = true;
                            }
                        }
                    } else {
                        weekLimit = false;
                    }
                    if (exclude) {
                        if (isExcluded) {
                            return false;
                        }
                        if (h === undefined &amp;&amp; length !== 0) {
                            return false;
                        }
                        break;
                    }
                    if (weekLimit) {
                        return false;
                    }
                    if (h === undefined || length === 0) {
                        return hoursLimit = minutesLimit = secondsLimit = false;
                    }
                    break;
                    // 小时
                case &quot;h&quot;:
                    if (items[name] === undefined) {
                        hoursLimit = false;
                    } else {
                        length -= 1;
                        if (that.inArray(items[name], h)) {
                            if (exclude &amp;&amp; length === 0 &amp;&amp; !yearLimit &amp;&amp; !monthLimit &amp;&amp; !dateLimit &amp;&amp; !dayLimit &amp;&amp; !weekLimit) {
                                isExcluded = true;
                            }
                            hoursLimit = false;
                        }
                    }
                    if (exclude) {
                        if (isExcluded) {
                            return false;
                        }
                        if (m === undefined &amp;&amp; length !== 0) {
                            return false;
                        }
                        break;
                    }
                    if (hoursLimit) {
                        return false;
                    }
                    if (m === undefined || length === 0) {
                        return minutesLimit = secondsLimit = false;
                    }
                    break;
                    // 分
                case &quot;m&quot;:
                    if (items[name] === undefined) {
                        minutesLimit = false;
                    } else {
                        length -= 1;
                        if (that.inArray(items[name], m)) {
                            if (exclude &amp;&amp; length === 0 &amp;&amp; !yearLimit &amp;&amp; !monthLimit &amp;&amp; !dateLimit &amp;&amp; !dayLimit &amp;&amp; !weekLimit &amp;&amp; !hoursLimit) {
                                isExcluded = true;
                            }
                            minutesLimit = false;
                        }
                    }
                    if (exclude) {
                        if (isExcluded) {
                            return false;
                        }
                        if (s === undefined &amp;&amp; length !== 0) {
                            return false;
                        }
                        break;
                    }
                    if (minutesLimit) {
                        return false;
                    }
                    if (s === undefined || length === 0) {
                        return secondsLimit = false;
                    }
                    break;
                    // 秒
                case &quot;s&quot;:
                    if (items[name] === undefined) {
                        secondsLimit = false;
                        break;
                    }
                    if (that.inArray(items[name], s)) {
                        if (exclude &amp;&amp; !yearLimit &amp;&amp; !monthLimit &amp;&amp; !dateLimit &amp;&amp; !dayLimit &amp;&amp; !weekLimit &amp;&amp; !hoursLimit &amp;&amp; !minutesLimit) {
                            isExcluded = true;
                        }
                        secondsLimit = false;
                    }
            }
        });
        // 判断结束
        return exclude ? isExcluded : !(yearLimit || monthLimit || dateLimit || dayLimit || weekLimit || hoursLimit || minutesLimit || secondsLimit);
    },
<span id='fastDev-Ui-DatePicker-method-inArray'>    /**
</span>     * 应用二分查找判断给定的元素是否在数组中
     * @param {Array} array 查找集
     * @param {Number} elem 被查找的元素
     * @param {Function} sorter 排序比较函数，应用在需要对数组排序时
     * @private
     */
    inArray: function (array, value, sorter) {
        if (!array) {
            return false;
        }
        if (sorter) {
            array.sort(typeof sorter === &quot;function&quot; ? sorter : function (a, b) {
                return a - b;
            });
        }
        var left = 0,
            right = array.length - 1,
            middle;
        if (value &lt; array[left] || value &gt; array[right]) {
            return false;
        }
        while (left &lt;= right) {
            middle = Math.round((left + right) / 2);
            if (array[middle] === value) {
                return true;
            } else if (value &lt; array[middle]) {
                right = middle - 1;
            } else {
                left = middle + 1;
            }
        }
        return false;
    },
<span id='fastDev-Ui-DatePicker-method-parseCronExpression'>    /**
</span>     * 解析cron日期表达式配置
     * @private
     */
    parseCronExpression: function () {
        var that = this,
            options = that._options,
            global = that._global,
            fn = fastDev.Util.StringUtil.trim;
        fastDev.each([&quot;includes&quot;, &quot;excludes&quot;], function (i, name) {
            var array = [];
            if (typeof options[name] === &quot;string&quot;) {
                options[name] = fn(options[name]);
                array.push(that.cronParser.parse(options[name], true)
                    .schedules[0]);
            } else if (fastDev.isArray(options[name])) {
                fastDev.each(options[name], function (i, val) {
                    array.push(that.cronParser.parse(fn(val), true)
                        .schedules[0]);
                });
            }
            global[name] = array;
        });
        // 根据表达式解析结果重新限定最大与最小日期
        that.mergeExtremum();
    },
<span id='fastDev-Ui-DatePicker-method-mergeExtremum'>    /**
</span>     * 根据表达式查找且合并日期极值点
     * @private
     */
    mergeExtremum: function () {
        var that = this,
            global = that._global,
            includes = global.includes,
            maxYear = 0,
            maxMonth = -1000,
            minYear = 999999,
            minMonth = 999999,
            length;
        fastDev.each(includes, function (i, include) {
            if (include.Y) {
                length = include.Y.length;
                if (maxYear &lt; include.Y[length - 1]) {
                    maxYear = include.Y[length - 1];
                }
                if (minYear &gt; include.Y[0]) {
                    minYear = include.Y[0];
                }
            }
            if (include.M) {
                length = include.M.length;
                if (maxMonth &lt; include.M[length - 1]) {
                    maxMonth = include.M[length - 1];
                }
                if (minMonth &gt; include.M[0]) {
                    minMonth = include.M[0];
                }
            }
        });
        if (maxYear !== 0 &amp;&amp; global.maxYear &gt; maxYear) {
            global.maxYear = maxYear;
        }
        if (maxMonth !== -1000 &amp;&amp; global.maxMonth &gt; maxMonth - 1) {
            global.maxMonth = maxMonth - 1;
        }
        if (minYear !== 999999 &amp;&amp; global.minYear &lt; minYear) {
            global.minYear = minYear;
        }
        if (minMonth !== 999999 &amp;&amp; global.minMonth &lt; minMonth - 1) {
            global.minMonth = minMonth - 1;
        }
        if (global.maxYear === global.maxDate.getFullYear() &amp;&amp; global.minYear === global.minDate.getFullYear()) {
            return;
        }
        fastDev.each([&quot;max&quot;, &quot;min&quot;], function (i, n) {
            var inc = i ? 1 : -1,
                left = global[n + &quot;Year&quot;],
                right = global[(i ? &quot;max&quot; : &quot;min&quot;) + &quot;Year&quot;],
                cur = {}, d, D;
            for (var Y = left; Y * inc &lt;= right * inc; Y += inc) {
                if (!that.isDisabled(Y)) {
                    cur.Y = Y;
                    for (var M = i ? 0 : 11, m = i ? 11 : 0; M * inc &lt;= m * inc; M += inc) {
                        if (!that.isDisabled(Y, M)) {
                            cur.M = M;
                            d = new Date(Y, M + 1, 0).getDate();
                            for (D = i ? 1 : d, d = i ? d : 1; D * inc &lt;= d * inc; D += inc) {
                                if (!that.isDisabled(Y, M, D)) {
                                    cur.D = D;
                                    break;
                                }
                            }
                            if (cur.D) {
                                break;
                            }
                        }
                    }
                    if (cur.M !== undefined &amp;&amp; cur.D) {
                        break;
                    }
                }
            }
            if (cur.Y) {
                global[n + &quot;Year&quot;] = cur.Y;
            }
            if (cur.M !== undefined) {
                global[n + &quot;Month&quot;] = cur.M;
            }
            if (cur.D !== undefined) {
                global[n + &quot;Day&quot;] = cur.D;
            }
        });
    },
<span id='fastDev-Ui-DatePicker-method-isSelected'>    /**
</span>     * 判断日期值是否为当前所选值
     * @param {Number} year
     * @param {Number} month
     * @param {Number} date
     * @return {Boolean}
     * @private
     */
    isSelected: function (year, month, date) {
        var global = this._global;
        return global.forSelectDate === date || (global.selectedDate === date &amp;&amp; global.selectedMonth === month &amp;&amp; global.selectedYear === year &amp;&amp; global.forSelectDate === date);
    },
<span id='fastDev-Ui-DatePicker-method-isShowTimePicker'>    /**
</span>     * 判断是否需要显示时间选择器
     * @private
     */
    isShowTimePicker: function () {
        var options = this._options;
        if (options.display === &quot;inline&quot;) {
            return false;
        }
        var global = this._global,
            format = options.format,
            // 查找小时域
            h = /.*[Hh]{1,2}.*/g.test(format),
            // 查找分钟域
            m = /.*m{1,2}.*/g.test(format),
            // 查找秒钟域
            s = /.*s{1,2}.*/g.test(format),
            //判断
            isShow = options.showTimePicker === true ? true : options.showTimePicker === false ? false : (h || m || s);
        if (isShow) {
            global.showHours = h;
            global.showMinutes = m;
            global.showSeconds = s;
        }
        return isShow;
    },
<span id='fastDev-Ui-DatePicker-method-forSelect'>    /**
</span>     * 预备选取
     * @param {Number} date 日
     * @param {Number} month 月（0~11）
     * @param {Number} year 年
     * @private
     */
    forSelect: function (date, month, year) {
        var options = this._options,
            global = this._global;
        global.body.find(&quot;.ui-datepicker-selected&quot;).removeClass(&quot;ui-datepicker-selected&quot;);
        global.body.find(&quot;[name='&quot; + date + &quot;-&quot; + global.sequence + &quot;']&quot;).addClass(&quot;ui-datepicker-selected&quot;);
        // 待选日期标记
        if (options.showTimePicker) {
            global.forSelectDate = date;
            if (this.isDisabled(year || global.year, month === undefined ? global.month : month, date, global.hours, global.minutes, global.seconds)) {
                // 需重新判断当天时间选择值是否有效
                this.timePickerBtnClick(&quot;up&quot;);
            }
        }
    },
<span id='fastDev-Ui-DatePicker-method-select'>    /**
</span>     * 选择指定的日期时间
     * @param {Date} date 日期对象
     * @return {Boolean} 是否已接受此值
     * @private
     */
    select: function (date) {
        var options = this._options,
            global = this._global,
            value;
        date = this.toValidDate(date);
        if ( !! date &amp;&amp; this.isDisabled(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds())) {
            return false;
        }
        value = date ? fastDev.Util.DateUtil.format(date, options.format) : &quot;&quot;;
        if (options.onPick.call(this, date, value) !== false) {
            options.value = value;
            if (options.display !== &quot;inline&quot;) {
                global.input.prop(&quot;value&quot;, value);
                global.input.elems[0].blur();
            }
            fastDev.each([&quot;After&quot;, &quot;Before&quot;], function (i, name) {
                name = &quot;time&quot; + name;
                global[name] = options[name].alias === &quot;DatePicker&quot; ? options[name] : fastDev.getInstance(options[name]);
            });
            if ( !! global.timeAfter &amp;&amp; global.timeAfter._global.initialized &amp;&amp; typeof global.timeAfter.setMaxDate === &quot;function&quot;) {
                global.timeAfter.setMaxDate(date);
            }
            if ( !! global.timeBefore &amp;&amp; global.timeBefore._global.initialized &amp;&amp; typeof global.timeBefore.setMinDate === &quot;function&quot;) {
                global.timeBefore.setMinDate(date);
            }
            fastDev.apply(global, {
                selectedYear: date ? date.getFullYear() : null,
                selectedMonth: date ? date.getMonth() : null,
                selectedDate: date ? date.getDate() : null,
                selectedValue: date,
                hours: date ? date.getHours() : null,
                minutes: date ? date.getMinutes() : null,
                seconds: date ? date.getSeconds() : null
            });
            return true;
        }
    },
<span id='fastDev-Ui-DatePicker-method-getTime'>    /**
</span>     * 获取有效时间值
     * @param {String} name
     * @return {Object}
     * @private
     */
    getTime: function (name) {
        var global = this._global,
            options = this._options,
            hours, minutes, seconds, time;
        hours = parseInt(global.timePickerHours.prop(&quot;value&quot;), 10);
        hours = isNaN(hours) ? 0 : hours &gt; 23 ? 23 : hours &lt; 0 ? 0 : hours;
        minutes = parseInt(global.timePickerMinutes.prop(&quot;value&quot;), 10);
        minutes = isNaN(minutes) ? 0 : minutes &gt; 59 ? 59 : minutes &lt; 0 ? 0 : minutes;
        seconds = parseInt(global.timePickerSeconds.prop(&quot;value&quot;), 10);
        seconds = isNaN(seconds) ? 0 : seconds &gt; 59 ? 59 : seconds &lt; 0 ? 0 : seconds;
        if (!this.isDisabled(global.year, global.month, global.forSelectDate, hours, minutes, seconds)) {
            return {
                hours: hours,
                minutes: minutes,
                seconds: seconds
            };
        } else {
            time = (name &amp;&amp; (name === &quot;timePickerUpBtn&quot; || name === &quot;timePickerDownBtn&quot;)) ? [hours, minutes, seconds] : this.getNextTime(hours, minutes, seconds, this.getTimeFocusName());
            return {
                hours: time[0],
                minutes: time[1],
                seconds: time[2]
            };
        }
    },
<span id='fastDev-Ui-DatePicker-method-refreshTimePicker'>    /**
</span>     * 刷新时间选择器
     * @param {Number} hours 小时
     * @param {Number} minutes 分钟
     * @param {Number} seconds 秒钟
     * @private
     */
    refreshTimePicker: function (hours, minutes, seconds) {
        if (this._options.showTimePicker) {
            var global = this._global,
                fn = fastDev.Util.NumberUtil.pad;
            // 时
            hours = global.showHours ? fn(hours || global.hours, 2) : &quot;00&quot;,
            // 分
            minutes = global.showMinutes ? fn(minutes || global.minutes, 2) : &quot;00&quot;,
            // 秒
            seconds = global.showSeconds ? fn(seconds || global.seconds, 2) : &quot;00&quot;;
            global.timePickerHours.prop(&quot;value&quot;, hours);
            global.timePickerMinutes.prop(&quot;value&quot;, minutes);
            global.timePickerSeconds.prop(&quot;value&quot;, seconds);
        }
    },
<span id='fastDev-Ui-DatePicker-method-position'>    /**
</span>     * 定位层
     * @param {fastDev.Core.DomObject} obj 需定位的对象
     * @param {fastDev.Core.DomObject} elem 相对其定位的元素
     * @return {fastDev.Core.DomObject} obj 定位对象
     * @private
     */
    position: function (obj, elem) {
        var win = fastDev(window),
            doc = fastDev(document),
            winWidth = win.width(),
            winHeight = win.height(),
            docLeft = doc.scrollLeft(),
            docTop = doc.scrollTop(),
            offset = elem.offset(),
            elemHeight = elem.outerHeight() + 3,
            height = offset.top + elemHeight,
            objHeight = obj.outerHeight() + 2;
        // 需要在可视区域内以最佳呈现视角来呈现
        // 目前不考虑跨iframe展示的情况
        return obj.css({
            left: Math.max(docLeft + 2, Math.min(offset.left - 1, winWidth - obj.outerWidth() + docLeft - 2)),
            top: height + objHeight &gt; winHeight + docTop ? offset.top - docTop &lt; winHeight + docTop - offset.top - elemHeight ? height : offset.top - objHeight : height,
            zIndex: obj === this._global.picker ? this._options.zIndex : this._options.zIndex + 1
        });
    },
<span id='fastDev-Ui-DatePicker-method-show'>    /**
</span>     * 显示日历面板
     * @return {fastDev.Ui.DatePicker} 本控件实例
     */
    show: function () {
        var global = this._global,
            options = this._options;
        if (global.isPickerShowed || options.readonly) {
            // 已显示日历面板或者只读状态，则返回
            return this;
        }
        // 显示日历面板
        global.picker.show();
        // 刷新面板
        this.refreshToRecent( !! global.selectedYear ? global.selectedValue : new Date());
        if (options.display === &quot;inline&quot;) {
            global.pageYear = global.year;
        } else {
            // 定位
            this.position(global.picker, global.input);
            // 聚焦
            global.input.parent().addClass(&quot;ui-form-focus&quot;);
            global.trigger.parent().addClass(&quot;ui-form-trigger-over&quot;);
        }
        // 绑定隐藏或刷新日历面板事件
        global.docClickEventHandle = fastDev.setFnInScope(this, this.documentClick);
        fastDev(document.documentElement).bind(&quot;click&quot;, global.docClickEventHandle);
        global.clear = true;
        global.isPickerShowed = true;
        return this;
    },
<span id='fastDev-Ui-DatePicker-method-hide'>    /**
</span>     * 隐藏日历面板
     * @return {fastDev.Ui.DatePicker} 本控件实例
     */
    hide: function () {
        var options = this._options,
            global = this._global;
        // 隐藏面板
        this.hideMenu(&quot;month&quot;);
        this.hideMenu(&quot;year&quot;);
        global.picker.hide();
        if (options.display === &quot;block&quot;) {
            // 因为点击面板后会取消事件冒泡（非行内模式下），所以关闭面板时解绑此事件非常有必要，以免影响其他控件的doc click事件监听
            fastDev(document.documentElement).unbind(&quot;click&quot;, global.docClickEventHandle);
            // 失焦
            global.input.parent().removeClass(&quot;ui-form-focus&quot;);
            global.trigger.parent().removeClass(&quot;ui-form-trigger-over&quot;);
            global.onBlur();
        }
        global.forSelectDate = null;
        global.isPickerShowed = false;
        return this;
    },
<span id='fastDev-Ui-DatePicker-method-toLocaleMonth'>    /**
</span>     * 获取本地化月份值
     * @param {Number} month 月
     * @return {String}
     * @private
     */
    toLocaleMonth: function (month) {
        var locale = [&quot;一月&quot;, &quot;二月&quot;, &quot;三月&quot;, &quot;四月&quot;, &quot;五月&quot;, &quot;六月&quot;, &quot;七月&quot;, &quot;八月&quot;, &quot;九月&quot;, &quot;十月&quot;, &quot;十一月&quot;, &quot;十二月&quot;];
        return locale[month];
    },
<span id='fastDev-Ui-DatePicker-method-toLocaleYear'>    /**
</span>     * 获取本地化年份值
     * @param {Number} year 年
     * @return {String}
     * @private
     */
    toLocaleYear: function (year) {
        return year + &quot;年&quot;;
    },
<span id='fastDev-Ui-DatePicker-method-toValidDate'>    /**
</span>     * 获取有效日期对象
     * @param {String|Date} date 需验证的日期字符串或对象
     * @return {Date} 若为有效日期，则返回解析后的日期对象，否则返回null
     */
    toValidDate: function (date) {
        if (date) {
            if (typeof date === &quot;string&quot;) {
                date = fastDev.Util.DateUtil.parse(fastDev.Util.StringUtil.trim(date));
            }
            var value = date.toString();
            if (!(value === &quot;Invalid Date&quot; || value === &quot;NaN&quot;)) {
                return date;
            }
        }
        return null;
    },
<span id='fastDev-Ui-DatePicker-method-cronParser'>    /**
</span>     * cron日期表达式解析器
     * @return {Object}
     * @private
     */
    // 为何使用闭包而不是直接存放在DatePicker中
    cronParser: (function () {
        // 常量配置
        var NAMES = {
            JAN: 1,
            // 一月
            FEB: 2,
            // 二月
            MAR: 3,
            // 三月
            APR: 4,
            // 四月
            MAY: 5,
            // 五月
            JUN: 6,
            // 六月
            JUL: 7,
            // 七月
            AUG: 8,
            // 八月
            SEP: 9,
            // 九月
            OCT: 10,
            // 十月
            NOV: 11,
            // 十一月
            DEC: 12,
            // 十二月
            SUN: 1,
            // 星期日
            MON: 2,
            // 星期一
            TUE: 3,
            // 星期二
            WED: 4,
            // 星期三
            THU: 5,
            // 星期四
            FRI: 6,
            // 星期五
            SAT: 7 // 星期六
        };
        // 表达式各子域参数范围配置
        //[子域位序,最小值,最大值]
        var FIELDS = {
            s: [0, 0, 59],
            // 秒
            m: [1, 0, 59],
            // 分钟
            h: [2, 0, 23],
            // 小时
            D: [3, 1, 31],
            // 日
            M: [4, 1, 12],
            // 月
            Y: [6, 1970, 2099],
            // 年
            d: [5, 1, 7] // 星期
        };
        // 取常量值或者计算偏移量的值
        var getValue = function (value, offset) {
            return isNaN(value) ? NAMES[value] : +value + (offset || 0);
        };
        // 克隆一份计划表
        var cloneSchedule = function (sched) {
            var clone = {}, field;
            for (field in sched) {
                if (field !== 'dc' &amp;&amp; field !== 'd') {
                    clone[field] = sched[field].slice(0);
                }
            }
            return clone;
        };
        // 按给定的增量获取指定范围内的值
        var add = function (sched, name, min, max, inc) {
            var i = min;
            if (!sched[name]) {
                // 新的有效子域
                sched[name] = [];
                // 域长+1
                sched.length += 1;
            }
            while (i &lt;= max) {
                // 添加范围内的值
                if ((sched[name] + &quot;&quot;).indexOf(i) &lt; 0) {
                    sched[name].push(i);
                }
                i += inc || 1;
            }
            sched[name].sort(itemSorter);
        };
        // 添加月中周哈希值（如：6#3，表示月中第三个周的星期五，哈希值即为3）
        var addHash = function (schedules, curSched, value, hash) {
            if ((curSched.d &amp;&amp; !curSched.dc) || (curSched.dc &amp;&amp; (curSched.dc + &quot;&quot;).indexOf(hash) &lt; 0)) {
                schedules.push(cloneSchedule(curSched));
                curSched = schedules[schedules.length - 1];
            }
            // d表示周内星期几
            // dc表示第几周，0表示最后一周
            add(curSched, 'd', value, value);
            add(curSched, 'dc', hash, hash);
        };
        // 添加离指定日子最近的工作日
        var addWeekday = function (s, curSched, value) {
            if (value === 1) {
                // D表示日
                // 当前日为星期日，则最近工作日取星期周一和周五
                add(curSched, 'D', 1, 3);
                add(curSched, 'd', NAMES.MON, NAMES.FRI);
            } else {
                // 取离最近的左右值
                add(curSched, 'D', value - 1, value + 1);
                add(curSched, 'd', NAMES.MON, NAMES.FRI);
            }
        };
        // 添加包含范围的值
        var addRange = function (item, curSched, name, min, max, offset) {
            var incSplit = item.split('/'),
                inc = +incSplit[1],
                range = incSplit[0],
                value;
            if (range !== '*' &amp;&amp; range !== '0') {
                var rangeSplit = range.split('-');
                min = getValue((value = rangeSplit[0]) ? value : min, offset);
                max = getValue((value = rangeSplit[1]) ? value : max, offset);
            }
            add(curSched, name, min, max, inc);
        };
        // 解析表达式子域
        var parse = function (item, s, name, min, max, offset) {
            var value, split, schedules = s.schedules,
                curSched = schedules[schedules.length - 1];
            // 月份的最后一天(L)
            if (item === 'L') {
                item = min - 1;
            }
            // 单一值(x)
            if ((value = getValue(item, offset)) !== undefined) {
                add(curSched, name, value, value);
            }
            // 离给定日子最近的工作日，仅能应用于&quot;日&quot;域上(xW)
            else if ((value = getValue(item.replace('W', ''), offset)) !== undefined) {
                addWeekday(s, curSched, value);
            }
            // 月中最后一个星期几，仅能应用于&quot;星期&quot;域上(xL)
            else if ((value = getValue(item.replace('L', ''), offset)) !== undefined) {
                addHash(schedules, curSched, value, min - 1);
            }
            // 位于月中第几周的星期几，仅能应用于&quot;星期&quot;域上(x#y)
            else if ((split = item.split('#')).length === 2) {
                value = getValue(split[0], offset);
                addHash(schedules, curSched, value, getValue(split[1]));
            }
            // 范围值(x-y or x-y/z or */z or 0/z)
            else {
                addRange(item, curSched, name, min, max, offset);
            }
        };
        // 判断是否是哈希值指定
        var isHash = function (item) {
            return typeof item === &quot;string&quot; &amp;&amp; (item.indexOf('#') &gt; -1 || item.indexOf('L') &gt; 0);
        };
        // 对散列值声明进行排序
        var itemSorter = function (a, b) {
            return isHash(a) &amp;&amp; !isHash(b) ? 1 : (parseInt(a, 10) || 0) - (parseInt(b, 10) || 0);
        };
        // 解析表达式
        var parseExpr = function (expr) {
            var schedule = {
                schedules: [{}]
            }, components = fastDev.Util.StringUtil.trim(expr).replace(/\t/g, ' ').split(/\s+/),
                field, f, component, items;
            // 允许不声明秒分时域，缺少的自动补齐
            if (components.length === 3 || components.length === 4) {
                components = [&quot;?&quot;, &quot;?&quot;, &quot;?&quot;].concat(components);
            }
            // 初始域长度
            schedule.schedules[0].length = 0;
            for (field in FIELDS) {
                // 取得表达式相应位序上的子表达式域
                f = FIELDS[field];
                component = components[f[0]];
                // &quot;*&quot;通配符以及&quot;?&quot;未定值则不处理
                if (component &amp;&amp; component !== '*' &amp;&amp; component !== '?') {
                    // 对散列值进行排序
                    items = component.split(',').sort(itemSorter);
                    var i, length = items.length;
                    for (i = 0; i &lt; length; i++) {
                        // 解析子表达式
                        parse(items[i], schedule, field, f[1], f[2], f[3]);
                    }
                }
            }
            return schedule;
        };
        return {
            /*
             * cron表达式解析接口
             * @param {String} expr: 需解析的cron表达式
             * @param {Bool} hasSeconds: 表达式是否使用了&quot;秒&quot;子表达式
             */
            parse: function (expr, hasSeconds) {
                // 星期与月份非数字符号值不区分大小写
                var e = expr.toUpperCase();
                return parseExpr(hasSeconds ? e : '0 ' + e);
            }
        };
    })(),
<span id='fastDev-Ui-DatePicker-method-setValue'>    /**
</span>     * 设置日期时间值
     * @param {String|Date} value 字符串形式或日期对象形式的日期时间值
     * @return {fastDev.Ui.DatePicker} 本控件实例
     */
    setValue: function (value) {
        this.select(value);
        if (this._options.display === &quot;inline&quot;) {
            this.refreshToRecent();
        }
        return this;
    },
<span id='fastDev-Ui-DatePicker-method-getValue'>    /**
</span>     * 获取日期时间值
     * @return {String} 按配置格式格式化后的日期时间值
     */
    getValue: function () {
        return this._options.value;
    },
<span id='fastDev-Ui-DatePicker-method-getDate'>    /**
</span>     * 获取控件当前值的日期对象
     * @return {Date} 当前日期对象或者null
     */
    getDate: function () {
        return this._global.selectedValue || null;
    },
<span id='fastDev-Ui-DatePicker-method-setExpressions'>    /**
</span>     * 设置并刷新Cron日期表达式
     * 请注意，若要重设includes与excludes属性，请一并设置，不要通过调用2次该方法来分开设置。
     * 重设表达式后，会重新解析并刷新最大与最小日期值。
     * 若只指定一个参数，则另外一个参数对应的表达式其历史属性值仍然会保持有效状态，并不会被自动清除。
     * @param {String|Array} includes 可选日期表达式
     * @param {String|Array} excludes 禁选日期表达式
     * @return {fastDev.Ui.DatePicker} 本控件实例
     */
    setExpressions: function (includes, excludes) {
        var options = this._options;
        if (includes !== undefined) {
            options.includes = includes;
        }
        if (excludes !== undefined) {
            options.excludes = excludes;
        }
        this.parseCronExpression();
        return this;
    },
<span id='fastDev-Ui-DatePicker-method-removeExpressions'>    /**
</span>     * 移除并刷新Cron日期表达式
     * 移除表达式后，会重新解析现有表达式
     * @param {Boolean} includes 是否移除可选日期表达式
     * @param {Boolean} excludes 是否移除禁选日期表达式
     * @return {fastDev.Ui.DatePicker} 本控件实例
     */
    removeExpressions: function (includes, excludes) {
        var options = this._options,
            global = this._global;
        if (includes !== undefined) {
            options.includes = global.includes = [];
        }
        if (excludes !== undefined) {
            options.excludes = global.excludes = [];
        }
        this.setMinDate(options.minDate);
        this.setMaxDate(options.maxDate);
        return this;
    },
<span id='fastDev-Ui-DatePicker-method-setExtremumDate'>    /**
</span>     * 设置极值日期
     * @param {String} type max或min
     * @return {fastDev.Ui.DatePicker}
     * @private
     */
    setExtremumDate: function (date, type) {
        var global = this._global,
            options = this._options,
            extremum, time;
        date = this.toValidDate(date);
        if (date &amp;&amp; (time = date.getTime()) &lt;= global.maxDate.getTime() &amp;&amp; time &gt;= global.minDate.getTime()) {
            extremum = options[type + &quot;Date&quot;] = date;
        } else {
            extremum = options[type + &quot;Date&quot;] = global[type + &quot;Date&quot;];
        }
        global[type + &quot;Year&quot;] = extremum.getFullYear();
        global[type + &quot;Month&quot;] = extremum.getMonth();
        global[type + &quot;Day&quot;] = extremum.getDate();
        global[type + &quot;Hours&quot;] = extremum.getHours();
        global[type + &quot;Minutes&quot;] = extremum.getMinutes();
        global[type + &quot;Seconds&quot;] = extremum.getSeconds();
        if (type === &quot;max&quot;) {
            if (extremum.getTime() &lt; options.minDate.getTime()) {
                this.setMinDate(global.minDate);
            }
            if (global.selectedValue &amp;&amp; global.selectedValue.getTime() &gt; extremum.getTime()) {
                this.setValue(&quot;&quot;);
            }
        } else {
            if (extremum.getTime() &gt; options.maxDate.getTime()) {
                this.setMaxDate(global.maxDate);
            }
            if (global.selectedValue &amp;&amp; global.selectedValue.getTime() &lt; extremum.getTime()) {
                this.setValue(&quot;&quot;);
            }
        }
        if (options.display === &quot;inline&quot;) {
            this.refreshToRecent();
        }
        return this;
    },
<span id='fastDev-Ui-DatePicker-method-setMinDate'>    /**
</span>     * 设置最小日期限制
     * @param {String|Date} date 日期时间字符串或日期对象
     * @return {fastDev.Ui.DatePicker} 本控件实例
     */
    setMinDate: function (date) {
        return this.setExtremumDate(date, &quot;min&quot;);
    },
<span id='fastDev-Ui-DatePicker-method-setMaxDate'>    /**
</span>     * 设置最大日期限制
     * @param {String|Date} date 日期时间字符串或日期对象
     * @return {fastDev.Ui.DatePicker} 本控件实例
     */
    setMaxDate: function (date) {
        return this.setExtremumDate(date, &quot;max&quot;);
    },
<span id='fastDev-Ui-DatePicker-method-setReadonly'>    /**
</span>     * 设置只读
     * @param {Boolean} readonly
     * @return {fastDev.Ui.DatePicker} 本控件实例
     */
    setReadonly: function (readonly) {
        var options = this._options;
        if (options.display === &quot;inline&quot; || !! options.disabled) {
            return;
        }
        options.readonly = readonly;
        return this;
    },
<span id='fastDev-Ui-DatePicker-method-enable'>    /**
</span>     * 启用控件
     */
    enable: function () {
        this._options.disabled = false;
        this.setReadonly(false);
        this._global.input.prop(&quot;disabled&quot;, &quot;&quot;).parent().removeClass(&quot;ui-form-disabled&quot;);
    },
<span id='fastDev-Ui-DatePicker-method-disable'>    /**
</span>     * 禁用控件
     */
    disable: function () {
        this._options.disabled = false;
        this.setReadonly(true);
        this._options.disabled = true;
        this._global.input.prop(&quot;disabled&quot;, &quot;disabled&quot;).parent().addClass(&quot;ui-form-disabled&quot;);
    },
<span id='fastDev-Ui-DatePicker-method-showLunarTips'>    /**
</span>     * 显示农历提示标签
     * @param {Array} name 日期项名
     * @return {String} tips
     * @private
     */
    showLunarTips: function (name) {
        var global = this._global,
            month = name[2] === &quot;prev&quot; ? global.month - 1 : name[2] === &quot;next&quot; ? global.month + 1 : global.month,
            year = month &lt; 0 ? global.year - 1 : month &gt; 11 ? global.year + 1 : global.year,
            date = new Date(year, month = month &lt; 0 ? 11 : month &gt; 11 ? 0 : month, name[0]);
        return this.getLunarTips(date);
    },
<span id='fastDev-Ui-DatePicker-method-getLunarTips'>    /**
</span>     * 获取农历提示信息
     * @param {Date} date 阳历日期
     * @return {String}
     * @private
     */
    getLunarTips: function (date) {
        if (date.getTime() &lt; new Date(1900, 0, 31).getTime()) {
            return &quot;&quot;;
        }
        var lunarDate = this.getLunarDate(date),
            solarTerm, festival, tips = [];
        if (lunarDate.isLeap) {
            tips.push(&quot;闰&quot;);
        }
        tips.push(this.localeMonth[lunarDate.month - 1] + &quot;月&quot;);
        tips.push(this.getLocaleDate(lunarDate.date));
        tips.push(&quot; &quot; + lunarDate.zodiac + &quot;年&quot;);
        // 二十四节气
        solarTerm = this.getSolarTerm(date);
        if ( !! solarTerm) {
            tips.push(&quot; &quot; + solarTerm);
        }
        // 佳节
        festival = this.getFestival(lunarDate, date);
        if ( !! festival) {
            tips.push(&quot; &quot; + festival);
        }
        return tips.join(&quot;&quot;);
    },
<span id='fastDev-Ui-DatePicker-method-getLunarDate'>    /**
</span>     * 获取月历（即阴历）日期
     * @param {Date} date 阳历日期
     * @return {Object}
     * @private
     */
    getLunarDate: function (date) {
        var year, month, day, leap, isLeap, days,
        // 根据世界时，取得阳历日期与1900年1月1日0点0时0分所相差的天数
        offset = (Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()) - Date.UTC(1900, 0, 31)) / 86400000;
        for (year = 1900; year &lt; 2100 &amp;&amp; offset &gt; 0; year += 1) {
            days = this.getDaysOfLunarYear(year);
            offset -= days;
        }
        if (offset &lt; 0) {
            offset += days;
            year -= 1;
        }
        leap = this.getLeapMonthOfYear(year);
        isLeap = false;
        for (month = 1; month &lt; 13 &amp;&amp; offset &gt; 0; month += 1) {
            if (leap &gt; 0 &amp;&amp; month === leap + 1 &amp;&amp; isLeap === false) {
                month -= 1;
                isLeap = true;
                days = this.getLeapDaysOfYear(year);
            } else {
                days = this.getDaysOfLunarMonth(year, month);
            }
            if (isLeap === true &amp;&amp; month === leap + 1) {
                isLeap = false;
            }
            offset -= days;
        }
        if (offset === 0 &amp;&amp; leap &gt; 0 &amp;&amp; month === leap + 1) {
            if (isLeap) {
                isLeap = false;
            } else {
                isLeap = true;
                month += 1;
            }
        }
        if (offset &lt; 0) {
            offset += days;
            month -= 1;
        }
        day = offset + 1;
        return {
            year: year,
            month: month,
            date: day,
            isLeap: isLeap,
            zodiac: this.zodiac[(year - 4) % 12]
        };
    },
<span id='fastDev-Ui-DatePicker-method-getDaysOfLunarYear'>    /**
</span>     * 获取阴历在给定年的总天数
     * @param {Number} year 农历年份
     * @return {Number}
     * @private
     */
    getDaysOfLunarYear: function (year) {
        var table = this.lunarTable,
            sum = 348;
        for (var i = 0x8000; i &gt; 0x8; i &gt;&gt;= 1) {
            sum += (table[year - 1900] &amp; i) ? 1 : 0;
        }
        return sum + this.getLeapDaysOfYear(year);
    },
<span id='fastDev-Ui-DatePicker-method-getDaysOfLunarMonth'>    /**
</span>     * 获取农历某年某月份的总天数
     * @param {Number} year 农历年份
     * @param {Number} month 农历月份
     * @return {Number}
     * @private
     */
    getDaysOfLunarMonth: function (year, month) {
        return (this.lunarTable[year - 1900] &amp; (0x10000 &gt;&gt; month)) ? 30 : 29;
    },
<span id='fastDev-Ui-DatePicker-method-getLeapDaysOfYear'>    /**
</span>     * 获取当前年闰月的总天数
     * @param {Number} year 农历年份
     * @return {Number}
     * @private
     */
    getLeapDaysOfYear: function (year) {
        return this.getLeapMonthOfYear(year) ? (this.lunarTable[year - 1899] &amp; 0xf) === 0xf ? 30 : 29 : 0;
    },
<span id='fastDev-Ui-DatePicker-method-getLeapMonthOfYear'>    /**
</span>     * 获取当前年闰月所在月份
     * @param {Number} year 农历年份
     * @return {Number} 0-12，0表示无闰月
     * @private
     */
    getLeapMonthOfYear: function (year) {
        var leapMonth = this.lunarTable[year - 1900] &amp; 0xf;
        return leapMonth === 0xf ? 0 : leapMonth;
    },
<span id='fastDev-Ui-DatePicker-method-getDayWithSolarTerm'>    /**
</span>     * 获取当前年指定序号的节气所在的阳历日子
     * 节气序号从0开始，依次为&quot;小寒&quot;、&quot;大寒&quot;、...
     * @param {Number} year 阳历年份
     * @param {Number} num 节气序号
     * @return {Number}
     * @private
     */
    getDayWithSolarTerm: function (year, num) {
        return (this.solarTermBase[num] + Math.floor(this.solarTermOS.charAt((Math.floor(this.solarTermIdx.charCodeAt(year - 1900)) - 48) * 24 + num)));
    },
<span id='fastDev-Ui-DatePicker-method-getSolarTerm'>    /**
</span>     * 获取当天所拥有的二十四节气值
     * @param {Date} date 当前阳历日期
     * @return {String} 当前日期无节气则返回空字符串
     * @private
     */
    getSolarTerm: function (date) {
        var year = date.getFullYear(),
            month = date.getMonth(),
            day = date.getDate(),
            num = date.getMonth() * 2;
        if (this.getDayWithSolarTerm(year, num) === day || this.getDayWithSolarTerm(year, ++num) === day) {
            return this.solarTerm[num];
        }
        return &quot;&quot;;
    },
<span id='fastDev-Ui-DatePicker-method-getFestival'>    /**
</span>     * 获取节日信息
     * @param {Date} solar 当前阳历日期
     * @param {Object} lunar 当前农历日期
     * @return {String} 当前日期无佳节，则返回空字符串
     * @private
     */
    getFestival: function (lunar, solar) {
        var small = this.getDaysOfLunarMonth(lunar.year, lunar.month) === 29,
            month = solar.getMonth() + 1,
            date = solar.getDate(),
            res = &quot;&quot;,
            festi, day, i;
        if (!lunar.isLeap) {
            for (i in this.lunarFestival) {
                festi = this.lunarFestival[i].split(&quot; &quot;);
                if (parseInt(festi[0], 10) === lunar.month) {
                    if (((day = parseInt(festi[1], 10)) === lunar.date)) {
                        res = festi[2];
                        break;
                    }
                    if (small &amp;&amp; lunar.month === 12 &amp;&amp; lunar.date === 29 &amp;&amp; day === 30) {
                        res = festi[2];
                        break;
                    }
                }
            }
        }
        for (i in this.solarFestival) {
            festi = this.solarFestival[i].split(&quot; &quot;);
            if (parseInt(festi[0], 10) === month &amp;&amp; parseInt(festi[1], 10) === date) {
                res = res ? res + &quot; &quot; + festi[2] : festi[2];
                break;
            }
        }
        return res;
    },
<span id='fastDev-Ui-DatePicker-method-getLocaleDate'>    /**
</span>     * 获取本地化日期（中文）
     * @param {Number} day 日子
     * @return {String}
     * @private
     */
    getLocaleDate: function (day) {
        switch (day) {
            case 10:
                return '初十';
            case 20:
                return '二十';
            case 30:
                return '三十';
            default:
                return ['初', '十', '廿', '卅'][Math.floor(day / 10)] + [&quot;日&quot;, '一', '二', '三', '四', '五', '六', '七', '八', '九', '十'][day % 10];
        }
    },
    // 使用的是查表方式，每一个数组元素即保存了一个年份的农历信息（转换成二进制，每位一个信息点）
    lunarTable: [0x4bd8, 0x4ae0, 0xa570, 0x54d5, 0xd260, 0xd950, 0x5554, 0x56af, 0x9ad0, 0x55d2, 0x4ae0, 0xa5b6, 0xa4d0, 0xd250, 0xd295, 0xb54f, 0xd6a0, 0xada2, 0x95b0, 0x4977, 0x497f, 0xa4b0, 0xb4b5, 0x6a50, 0x6d40, 0xab54, 0x2b6f, 0x9570, 0x52f2, 0x4970, 0x6566, 0xd4a0, 0xea50, 0x6a95, 0x5adf, 0x2b60, 0x86e3, 0x92ef, 0xc8d7, 0xc95f, 0xd4a0, 0xd8a6, 0xb55f, 0x56a0, 0xa5b4, 0x25df, 0x92d0, 0xd2b2, 0xa950, 0xb557, 0x6ca0, 0xb550, 0x5355, 0x4daf, 0xa5b0, 0x4573, 0x52bf, 0xa9a8, 0xe950, 0x6aa0, 0xaea6, 0xab50, 0x4b60, 0xaae4, 0xa570, 0x5260, 0xf263, 0xd950, 0x5b57, 0x56a0, 0x96d0, 0x4dd5, 0x4ad0, 0xa4d0, 0xd4d4, 0xd250, 0xd558, 0xb540, 0xb6a0, 0x95a6, 0x95bf, 0x49b0, 0xa974, 0xa4b0, 0xb27a, 0x6a50, 0x6d40, 0xaf46, 0xab60, 0x9570, 0x4af5, 0x4970, 0x64b0, 0x74a3, 0xea50, 0x6b58, 0x5ac0, 0xab60, 0x96d5, 0x92e0, 0xc960, 0xd954, 0xd4a0, 0xda50, 0x7552, 0x56a0, 0xabb7, 0x25d0, 0x92d0, 0xcab5, 0xa950, 0xb4a0, 0xbaa4, 0xad50, 0x55d9, 0x4ba0, 0xa5b0, 0x5176, 0x52bf, 0xa930, 0x7954, 0x6aa0, 0xad50, 0x5b52, 0x4b60, 0xa6e6, 0xa4e0, 0xd260, 0xea65, 0xd530, 0x5aa0, 0x76a3, 0x96d0, 0x4afb, 0x4ad0, 0xa4d0, 0xd0b6, 0xd25f, 0xd520, 0xdd45, 0xb5a0, 0x56d0, 0x55b2, 0x49b0, 0xa577, 0xa4b0, 0xaa50, 0xb255, 0x6d2f, 0xada0, 0x4b63, 0x937f, 0x49f8, 0x4970, 0x64b0, 0x68a6, 0xea5f, 0x6b20, 0xa6c4, 0xaaef, 0x92e0, 0xd2e3, 0xc960, 0xd557, 0xd4a0, 0xda50, 0x5d55, 0x56a0, 0xa6d0, 0x55d4, 0x52d0, 0xa9b8, 0xa950, 0xb4a0, 0xb6a6, 0xad50, 0x55a0, 0xaba4, 0xa5b0, 0x52b0, 0xb273, 0x6930, 0x7337, 0x6aa0, 0xad50, 0x4b55, 0x4b6f, 0xa570, 0x54e4, 0xd260, 0xe968, 0xd520, 0xdaa0, 0x6aa6, 0x56df, 0x4ae0, 0xa9d4, 0xa4d0, 0xd150, 0xf252, 0xd520],
    // 十二生肖
    zodiac: [&quot;鼠&quot;, &quot;牛&quot;, &quot;虎&quot;, &quot;兔&quot;, &quot;龙&quot;, &quot;蛇&quot;, &quot;马&quot;, &quot;羊&quot;, &quot;猴&quot;, &quot;鸡&quot;, &quot;狗&quot;, &quot;猪&quot;],
    localeMonth: [&quot;正&quot;, &quot;二&quot;, &quot;三&quot;, &quot;四&quot;, &quot;五&quot;, &quot;六&quot;, &quot;七&quot;, &quot;八&quot;, &quot;九&quot;, &quot;十&quot;, &quot;冬&quot;, &quot;腊&quot;],
    // 二十四节气
    solarTerm: [&quot;小寒&quot;, &quot;大寒&quot;, &quot;立春&quot;, &quot;雨水&quot;, &quot;惊蛰&quot;, &quot;春分&quot;, &quot;清明&quot;, &quot;谷雨&quot;, &quot;立夏&quot;, &quot;小满&quot;, &quot;芒种&quot;, &quot;夏至&quot;, &quot;小暑&quot;, &quot;大暑&quot;, &quot;立秋&quot;, &quot;处暑&quot;, &quot;白露&quot;, &quot;秋分&quot;, &quot;寒露&quot;, &quot;霜降&quot;, &quot;立冬&quot;, &quot;小雪&quot;, &quot;大雪&quot;, &quot;冬至&quot;],
    solarTermBase: [4, 19, 3, 18, 4, 19, 4, 19, 4, 20, 4, 20, 6, 22, 6, 22, 6, 22, 7, 22, 6, 21, 6, 21],
    solarTermIdx: &quot;0123415341536789:;&lt;9:=&lt;&gt;:=1&gt;?012@015@015@015AB78CDE8CD=1FD01GH01GH01IH01IJ0KLMN;LMBEOPDQRST0RUH0RVH0RWH0RWM0XYMNZ[MB\\]PT^_ST`_WH`_WH`_WM`_WM`aYMbc[Mde]Sfe]gfh_gih_Wih_WjhaWjka[jkl[jmn]ope]qph_qrh_sth_W&quot;,
    solarTermOS: &quot;211122112122112121222211221122122222212222222221222122222232222222222222222233223232223232222222322222112122112121222211222122222222222222222222322222112122112121222111211122122222212221222221221122122222222222222222222223222232222232222222222222112122112121122111211122122122212221222221221122122222222222222221211122112122212221222211222122222232222232222222222222112122112121111111222222112121112121111111222222111121112121111111211122112122112121122111222212111121111121111111111122112122112121122111211122112122212221222221222211111121111121111111222111111121111111111111111122112121112121111111222111111111111111111111111122111121112121111111221122122222212221222221222111011111111111111111111122111121111121111111211122112122112121122211221111011111101111111111111112111121111121111111211122112122112221222211221111011111101111111110111111111121111111111111111122112121112121122111111011111121111111111111111011111111112111111111111011111111111111111111221111011111101110111110111011011111111111111111221111011011101110111110111011011111101111111111211111001011101110111110110011011111101111111111211111001011001010111110110011011111101111111110211111001011001010111100110011011011101110111110211111001011001010011100110011001011101110111110211111001010001010011000100011001011001010111110111111001010001010011000111111111111111111111111100011001011001010111100111111001010001010000000111111000010000010000000100011001011001010011100110011001011001110111110100011001010001010011000110011001011001010111110111100000010000000000000000011001010001010011000111100000000000000000000000011001010001010000000111000000000000000000000000011001010000010000000&quot;,
    // 传统佳节
    lunarFestival: [&quot;01 01 春节&quot;, &quot;01 15 元宵节&quot;, &quot;05 05 端午节&quot;, &quot;07 07 七夕&quot;, &quot;07 15 中元节&quot;, &quot;08 15 中秋节&quot;, &quot;09 09 重阳节&quot;, &quot;12 08 腊八节&quot;, &quot;12 23 小年&quot;, &quot;12 30 除夕&quot;],
    // 公历节日
    solarFestival: [&quot;01 01 元旦&quot;, &quot;02 14 情人节&quot;, &quot;03 08 妇女节&quot;, &quot;03 12 植树节&quot;, &quot;03 15 消费者权益日&quot;, &quot;04 01 愚人节&quot;, &quot;05 01 劳动节&quot;, &quot;05 04 青年节&quot;, &quot;06 01 儿童节&quot;, &quot;08 01 建军节&quot;, &quot;09 10 教师节&quot;, &quot;10 01 国庆节&quot;, &quot;12 24 平安夜&quot;, &quot;12 25 圣诞节&quot;]
});</pre>
</body>
</html>
